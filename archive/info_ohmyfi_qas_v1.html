<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Rentabilidad OhmyFi | AGT</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        :root {
            --primary-color: #007BFF;
            --secondary-color: #FFA500;
            --background-color: #121212;
            --surface-color: #1E1E1E;
            --text-color: #E0E0E0;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 2rem;
            line-height: 1.6;
        }
        #ohmyfi-app-container {
            max-width: 900px;
            margin: auto;
            background-color: var(--background-color);
            padding: 2rem;
            border-radius: 15px;
        }
        h1, h2, h3 {
            color: var(--primary-color);
            text-align: center;
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        .subtitle {
            text-align: center;
            font-size: 1.2rem;
            margin-bottom: 3rem;
            color: var(--secondary-color);
        }
        .card {
            background-color: var(--surface-color);
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        input[type="range"] {
            width: 100%;
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: #444;
            border-radius: 5px;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
        }
        .slider-value {
            display: inline-block;
            margin-left: 10px;
            font-weight: bold;
            color: var(--secondary-color);
        }
        select {
            width: 100%;
            padding: 0.8rem;
            background-color: #333;
            color: var(--text-color);
            border: 1px solid #555;
            border-radius: 5px;
            font-size: 1rem;
        }
        .model-explanation {
            font-size: 0.9rem;
            color: #aaa;
            margin-top: 0.5rem;
            padding-left: 0.5rem;
            border-left: 2px solid var(--primary-color);
        }
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            text-align: center;
        }
        .kpi-card {
            background-color: #2a2a2a;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 5px solid var(--primary-color);
        }
        .kpi-title {
            font-size: 1rem;
            color: #aaa;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .kpi-value {
            font-size: 2rem;
            font-weight: bold;
            margin-top: 0.5rem;
        }
        .positive { color: var(--success-color); }
        .negative { color: var(--danger-color); }
        .neutral { color: var(--secondary-color); }

        .btn {
            display: inline-block;
            width: calc(100% - 2rem);
            padding: 1rem;
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            border-radius: 5px;
            text-decoration: none;
            font-size: 1.2rem;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .btn-secondary {
            background-color: #6c757d;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
        }
        .modal-content {
            background-color: var(--surface-color);
            margin: 10% auto;
            padding: 25px;
            border: 1px solid #888;
            width: 80%;
            max-width: 700px;
            border-radius: 10px;
            color: var(--text-color);
        }
        .modal-header {
            text-align: center;
            border-bottom: 1px solid #444;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        .modal-header h2 {
            color: var(--primary-color);
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .report-section h3 {
            color: var(--secondary-color);
            text-align: left;
            border-bottom: 1px solid var(--secondary-color);
            padding-bottom: 5px;
        }
        .report-kpis {
            display: flex;
            justify-content: space-around;
            text-align: center;
            margin: 20px 0;
        }
        .footer {
            text-align: center;
            margin-top: 3rem;
            font-size: 0.9rem;
            color: #777;
        }
    </style>
</head>
<body>
<div id="ohmyfi-app-container">
    <h1>Descubre el Potencial de Rentabilidad de tu Red WiFi</h1>
    <p class="subtitle">Transforma tu Gasto en WiFi en un Motor de Crecimiento para tu Negocio</p>

    <div id="simulator" class="card">
        <h2>Simulador Interactivo de Rentabilidad</h2>

        <div class="form-group">
            <label for="business-model">Selecciona tu Modelo de Negocio</label>
            <select id="business-model">
                <option value="direct_sale">Venta Directa (Ej: Cafetería, Tienda, Hotel)</option>
                <option value="audience_monetization">Monetización de Audiencia (Ej: Centro Comercial, Estadio)</option>
            </select>
            <p id="model-explanation" class="model-explanation">En este modelo, el WiFi impulsa la venta directa de tus productos o servicios.</p>
        </div>

        <div class="form-group">
            <label for="aps">Número de Puntos de Acceso (APs)</label>
            <input type="range" id="aps" min="1" max="100" value="5">
            <span class="slider-value" id="aps-value">5</span>
        </div>

        <div class="form-group">
            <label for="connections" id="connections-label">Conexiones Semanales por AP</label>
            <input type="range" id="connections" min="10" max="1000" value="150">
            <span class="slider-value" id="connections-value">150</span>
        </div>

        <div id="direct-sale-inputs">
             <div class="form-group">
                <label for="conversion">Tasa de Conversión a Cliente (%)</label>
                <input type="range" id="conversion" min="1" max="50" value="10">
                <span class="slider-value" id="conversion-value">10%</span>
            </div>
            <div class="form-group">
                <label for="avg-ticket">Valor de Transacción Promedio ($)</label>
                <input type="range" id="avg-ticket" min="5" max="500" value="25">
                <span class="slider-value" id="avg-ticket-value">$25</span>
            </div>
            <div class="form-group">
                <label for="recurrence">Tasa de Recurrencia de Clientes (%)</label>
                <input type="range" id="recurrence" min="0" max="100" value="30">
                <span class="slider-value" id="recurrence-value">30%</span>
            </div>
        </div>

        <div id="audience-monetization-inputs" style="display: none;">
            <div class="form-group">
                <label for="monetization-value">Valor de Monetización por Conexión ($)</label>
                <input type="range" id="monetization-value" min="0.01" max="2.00" value="0.10" step="0.01">
                <span class="slider-value" id="monetization-value-value">$0.10</span>
            </div>
        </div>
    </div>

    <div id="results" class="card">
        <h2>Resultados de la Simulación Financiera</h2>
        <div id="results-grid" class="results-grid">
            </div>
    </div>
    
    <div id="actions" class="card" style="text-align: center;">
         <h2>Genera tu Diagnóstico Personalizado</h2>
         <p>Obtén un informe detallado en PDF con el análisis de tu caso y los próximos pasos recomendados.</p>
         <button id="generate-report-btn" class="btn">Generar Informe de Consultoría</button>
    </div>

    <div class="footer">
        <p>&copy; 2025 AGT | Soluciones Tecnológicas. Todos los derechos reservados.</p>
        <p>Versión 43.2</p>
    </div>
</div>

<div id="report-modal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <span class="close">&times;</span>
      <h2>Diagnóstico Estratégico OhmyFi</h2>
    </div>
    <div id="report-body">
        <p>Este es un resumen de tu proyección financiera. Descarga el informe completo para un análisis detallado.</p>
        <div class="report-section">
            <h3>Indicadores Clave de Proyección</h3>
            <div class="report-kpis" id="report-kpis-summary">
                </div>
        </div>
        <div class="report-section">
             <h3>Próximos Pasos</h3>
             <p>Nuestro equipo de expertos puede ayudarte a implementar una estrategia a la medida para maximizar tu rentabilidad. El informe completo detalla las acciones recomendadas.</p>
        </div>
    </div>
    <div class="modal-footer" style="text-align: right; margin-top: 20px;">
        <button id="report-download-btn" class="btn">Descargar Informe en PDF</button>
        <button id="report-close-btn" class="btn btn-secondary">Cerrar</button>
    </div>
  </div>
</div>


<script>
(function() {
    // IIFE para encapsular el código y evitar conflictos en el scope global

    const businessModelSelect = document.getElementById('business-model');
    const modelExplanation = document.getElementById('model-explanation');
    const directSaleInputs = document.getElementById('direct-sale-inputs');
    const audienceMonetizationInputs = document.getElementById('audience-monetization-inputs');
    const connectionsLabel = document.getElementById('connections-label');

    const sliders = {
        aps: document.getElementById('aps'),
        connections: document.getElementById('connections'),
        conversion: document.getElementById('conversion'),
        avgTicket: document.getElementById('avg-ticket'),
        recurrence: document.getElementById('recurrence'),
        monetizationValue: document.getElementById('monetization-value'),
    };

    const values = {
        aps: document.getElementById('aps-value'),
        connections: document.getElementById('connections-value'),
        conversion: document.getElementById('conversion-value'),
        avgTicket: document.getElementById('avg-ticket-value'),
        recurrence: document.getElementById('recurrence-value'),
        monetizationValue: document.getElementById('monetization-value-value'),
    };
    
    const resultsGrid = document.getElementById('results-grid');
    const generateReportBtn = document.getElementById('generate-report-btn');
    const reportModal = document.getElementById('report-modal');
    const closeModalBtn = document.querySelector('.modal .close');
    const reportCloseBtn = document.getElementById('report-close-btn');
    const reportDownloadBtn = document.getElementById('report-download-btn');


    function formatCurrency(value) {
        return value.toLocaleString('es-VE', { style: 'currency', currency: 'VES' }).replace('VES', '$');
    }

    function updateSliderValue(id, value) {
        switch (id) {
            case 'conversion':
            case 'recurrence':
                values[id].textContent = `${value}%`;
                break;
            case 'avgTicket':
            case 'monetizationValue':
                values[id].textContent = formatCurrency(parseFloat(value));
                break;
            default:
                values[id].textContent = value;
        }
    }

    function calculateResults() {
        const weeksPerMonth = 4.33;
        const monthsPerYear = 12;
        const costPerAP = 35; // Costo mensual por AP

        const model = businessModelSelect.value;
        const numAps = parseInt(sliders.aps.value, 10);
        const weeklyConnectionsPerAP = parseInt(sliders.connections.value, 10);
        
        const totalMonthlyConnections = numAps * weeklyConnectionsPerAP * weeksPerMonth;
        const totalInvestment = numAps * costPerAP;
        
        let monthlyRevenue = 0;
        let roi = 0;
        let netProfit = 0;
        let paybackPeriod = Infinity; // en meses

        if (model === 'direct_sale') {
            const conversionRate = parseInt(sliders.conversion.value, 10) / 100;
            const avgTicketValue = parseFloat(sliders.avgTicket.value);
            const recurrenceRate = parseInt(sliders.recurrence.value, 10) / 100;

            const newCustomers = totalMonthlyConnections * conversionRate;
            const recurringCustomers = newCustomers * recurrenceRate;
            
            monthlyRevenue = (newCustomers + recurringCustomers) * avgTicketValue;
        } else { // audience_monetization
            const monetizationValue = parseFloat(sliders.monetizationValue.value);
            monthlyRevenue = totalMonthlyConnections * monetizationValue;
        }

        netProfit = monthlyRevenue - totalInvestment;

        if (totalInvestment > 0) {
            roi = (netProfit * monthsPerYear) / (totalInvestment * monthsPerYear) * 100;
        }
        
        if (netProfit > 0) {
            paybackPeriod = totalInvestment / netProfit;
        }

        displayResults({
            monthlyRevenue,
            totalInvestment,
            netProfit,
            paybackPeriod,
            roi
        });
    }
    
    function createKpiCard(title, value, iconName, unit = '', className = '') {
        const icon = lucide.createIcon(iconName);
        return `
            <div class="kpi-card">
                <div class="kpi-title">
                   ${icon.outerHTML}
                   <span>${title}</span>
                </div>
                <div class="kpi-value ${className}">${value}${unit}</div>
            </div>
        `;
    }

    function displayResults(data) {
        resultsGrid.innerHTML = ''; // Limpiar resultados anteriores
        
        resultsGrid.innerHTML += createKpiCard('Ingreso Mensual Proyectado', formatCurrency(data.monthlyRevenue), 'TrendingUp', '', 'positive');
        resultsGrid.innerHTML += createKpiCard('Inversión Mensual Estimada', formatCurrency(data.totalInvestment), 'Shield', '', 'negative');
        resultsGrid.innerHTML += createKpiCard('Beneficio Neto Mensual', formatCurrency(data.netProfit), 'Target', '', data.netProfit > 0 ? 'positive' : 'negative');
        
        const paybackText = isFinite(data.paybackPeriod) ? `${data.paybackPeriod.toFixed(1)}` : 'N/A';
        resultsGrid.innerHTML += createKpiCard('Período de Recuperación', paybackText, 'Clock', ' meses', 'neutral');
        
        resultsGrid.innerHTML += createKpiCard('ROI Anual Estimado', data.roi.toFixed(0), 'Percent', '%', data.roi > 0 ? 'positive' : 'negative');
    }

    function toggleBusinessModel() {
        const model = businessModelSelect.value;
        if (model === 'direct_sale') {
            directSaleInputs.style.display = 'block';
            audienceMonetizationInputs.style.display = 'none';
            modelExplanation.textContent = 'En este modelo, el WiFi impulsa la venta directa de tus productos o servicios.';
            connectionsLabel.textContent = 'Conexiones Semanales por AP';
        } else {
            directSaleInputs.style.display = 'none';
            audienceMonetizationInputs.style.display = 'block';
            modelExplanation.textContent = 'En este modelo, cada conexión es una oportunidad de generar ingresos (publicidad, datos, etc.).';
            connectionsLabel.textContent = 'Audiencia Semanal por AP';
        }
        calculateResults();
    }
    
    function initialize() {
        lucide.createIcons();
        for (const id in sliders) {
            updateSliderValue(id, sliders[id].value);
            sliders[id].addEventListener('input', (event) => {
                updateSliderValue(id, event.target.value);
                calculateResults();
            });
        }
        businessModelSelect.addEventListener('change', toggleBusinessModel);
        calculateResults(); // Calcular al cargar la página
    }

    function getSimulationData() {
        return {
            model: businessModelSelect.value === 'direct_sale' ? 'Venta Directa' : 'Monetización de Audiencia',
            aps: sliders.aps.value,
            connections: sliders.connections.value,
            monthlyRevenue: resultsGrid.children[0].querySelector('.kpi-value').textContent,
            netProfit: resultsGrid.children[2].querySelector('.kpi-value').textContent,
            roi: resultsGrid.children[4].querySelector('.kpi-value').textContent
        };
    }
    
    function showReportModal() {
        const data = getSimulationData();
        const kpisContainer = document.getElementById('report-kpis-summary');
        kpisContainer.innerHTML = `
            <div><strong>Ingreso Mensual</strong><br>${data.monthlyRevenue}</div>
            <div><strong>Beneficio Neto</strong><br>${data.netProfit}</div>
            <div><strong>ROI Anual</strong><br>${data.roi}</div>
        `;
        reportModal.style.display = 'block';
    }
    
    function downloadPDF() {
        try {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const data = getSimulationData();
            
            const addHeader = (doc) => {
                doc.setFontSize(20);
                doc.setTextColor(40, 40, 180);
                doc.text("Diagnóstico Estratégico OhmyFi para AGT", 105, 22, { align: 'center' });
            };
            
            const addFooter = (doc) => {
                const pageCount = doc.internal.getNumberOfPages();
                doc.setFontSize(10);
                doc.setTextColor(150);
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.text(`Página ${i} de ${pageCount}`, 105, 287, { align: 'center' });
                }
            };
            
            const addSectionTitle = (doc, title, y) => {
                doc.setFontSize(16);
                doc.setTextColor(0, 123, 255);
                doc.text(title, 14, y);
                doc.setDrawColor(0, 123, 255);
                doc.line(14, y + 2, 196, y + 2);
            };

            const addBodyText = (doc, text, y) => {
                 doc.setFontSize(11);
                 doc.setTextColor(40, 40, 40);
                 doc.text(text, 14, y, { maxWidth: 182 });
            };
            
            addHeader(doc);
            
            addSectionTitle(doc, "Resumen de la Simulación", 40);
            const summaryText = `
                - Modelo de Negocio: ${data.model}
                - Puntos de Acceso (APs): ${data.aps}
                - Conexiones Semanales por AP: ${data.connections}
            `;
            addBodyText(doc, summaryText.trim().replace(/^ +/gm, ''), 50);
            
            addSectionTitle(doc, "Proyección Financiera Clave", 80);
            const financialText = `
                - Ingreso Mensual Proyectado: ${data.monthlyRevenue}
                - Beneficio Neto Mensual: ${data.netProfit}
                - Retorno de Inversión (ROI) Anual: ${data.roi}
            `;
            addBodyText(doc, financialText.trim().replace(/^ +/gm, ''), 90);

            // Placeholder texts, these should be dynamic or more detailed in a real scenario
            addSectionTitle(doc, "Estrategia Recomendada", 120);
            const strategyText = `Basado en el modelo de "${data.model}", la estrategia inicial debe centrarse en maximizar el valor por conexión. Para la Venta Directa, esto implica optimizar la tasa de conversión con ofertas atractivas en el portal cautivo. Para la Monetización de Audiencia, se recomienda explorar múltiples vías de ingresos como publicidad programática y venta de data anonimizada.`;
            addBodyText(doc, strategyText, 130);
            
            addSectionTitle(doc, "Próximos Pasos", 170);
            const nextStepsText = `
                1.  Análisis Detallado: Agendar una sesión con nuestros consultores para un análisis profundo de la infraestructura y el flujo de clientes.
                2.  Diseño de Portal Cautivo: Crear un portal personalizado que se alinee con su marca y objetivos de conversión.
                3.  Implementación y Medición: Desplegar la solución y establecer KPIs claros para monitorear el rendimiento y optimizar continuamente.`;
            addBodyText(doc, nextStepsText.trim().replace(/^ +/gm, ''), 180);

            addFooter(doc);

            doc.save(`Reporte_Consultoria_AGT_OhmyFi_${new Date().toISOString().slice(0,10)}.pdf`);
            
        } catch (e) {
            console.error("PDF generation failed, trying fallback.", e);
            try {
                // Fallback for sandboxed environments like Zoho's iframe
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Re-generate the entire PDF content for the fallback
                const data = getSimulationData();
                addHeader(doc);
                addSectionTitle(doc, "Resumen de la Simulación", 40);
                const summaryText = `- Modelo de Negocio: ${data.model}\n- Puntos de Acceso (APs): ${data.aps}\n- Conexiones Semanales por AP: ${data.connections}`;
                addBodyText(doc, summaryText, 50);
                addSectionTitle(doc, "Proyección Financiera Clave", 80);
                const financialText = `- Ingreso Mensual Proyectado: ${data.monthlyRevenue}\n- Beneficio Neto Mensual: ${data.netProfit}\n- Retorno de Inversión (ROI) Anual: ${data.roi}`;
                addBodyText(doc, financialText, 90);
                addSectionTitle(doc, "Estrategia Recomendada", 120);
                const strategyText = `Basado en el modelo de "${data.model}", la estrategia inicial debe centrarse en maximizar el valor por conexión. Para la Venta Directa, esto implica optimizar la tasa de conversión con ofertas atractivas en el portal cautivo. Para la Monetización de Audiencia, se recomienda explorar múltiples vías de ingresos como publicidad programática y venta de data anonimizada.`;
                addBodyText(doc, strategyText, 130);
                addSectionTitle(doc, "Próximos Pasos", 170);
                const nextStepsText = `1.  Análisis Detallado: Agendar una sesión con nuestros consultores para un análisis profundo.\n2.  Diseño de Portal Cautivo: Crear un portal personalizado.\n3.  Implementación y Medición: Desplegar la solución y establecer KPIs claros.`;
                addBodyText(doc, nextStepsText, 180);
                addFooter(doc);
                
                window.open(doc.output('datauristring'));
            } catch (fallbackError) {
                console.error("PDF fallback also failed.", fallbackError);
                alert("No se pudo generar el PDF. Por favor, intente en otro navegador o contacte a soporte.");
            }
        }
    }
    
    // Event Listeners
    generateReportBtn.addEventListener('click', showReportModal);
    
    reportDownloadBtn.addEventListener('click', () => {
        downloadPDF();
        reportModal.style.display = 'none'; // Opcional: cerrar modal tras descarga
    });

    const hideModal = () => {
        reportModal.style.display = 'none';
    };
    closeModalBtn.addEventListener('click', hideModal);
    reportCloseBtn.addEventListener('click', hideModal);
    window.addEventListener('click', (event) => {
        if (event.target == reportModal) {
            hideModal();
        }
    });

    // --- Inicialización ---
    window.onload = function() {
        // Simple dependency check for Chart.js and lucide
        if (typeof Chart !== 'undefined' && typeof lucide !== 'undefined' && typeof jspdf !== 'undefined') {
            initialize();
        } else {
            console.error("Dependencies (Chart.js, jspdf, Lucide) not loaded.");
            // Podríamos intentar cargarlas de nuevo o mostrar un mensaje de error.
            // Por ahora, intentamos inicializar de todas formas.
             setTimeout(initialize, 500); // Intenta de nuevo tras 500ms
        }
    };

})();
</script>
</body>
</html>
