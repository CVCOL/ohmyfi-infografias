<!--
CONTROL DE VERSIONES
=====================
Versión: 16.6 (08/10/2025)
- Corrección del Payback Financiado: Se ajustó el motor de cálculo del período de recuperación para que el desembolso inicial sea $0 al seleccionar una opción de financiamiento, replicando la lógica correcta de la v6 y asegurando la precisión del KPI.

Versión: 16.5 (08/10/2025)
- Lógica de Negocio Restaurada: Se revierte el motor de cálculo a los parámetros fijos de la v6 (25 leads/AP, 10% conversión) para asegurar consistencia con los informes previos. Se elimina el campo de entrada de "Leads" para simplificar la UX.

Versión: 16.4 (08/10/2025)
- Código Antifrágil: Se implementó manejo de errores (try...catch) individual para la inicialización y actualización de cada gráfico. Esto previene fallas en cascada y asegura que el dashboard permanezca funcional incluso si un gráfico falla.
-->
<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análisis Interactivo de Valor: OhmyFi + Zoho en Venezuela</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --agt-dark: #0F172A; /* Slate 900 */
            --agt-blue: #1E3A8A; /* Indigo 800 */
            --agt-orange: #F97316; /* Orange 500 */
            --agt-light-gray: #F1F5F9; /* Slate 100 */
            --agt-text: #E2E8F0; /* Slate 200 */
        }
        body { 
            font-family: 'Inter', sans-serif;
            background-color: var(--agt-dark);
            color: var(--agt-text);
        }
        .section-title {
            font-size: 2.25rem;
            font-weight: 800;
            line-height: 1.2;
            text-align: center;
            margin-bottom: 1rem;
        }
        .section-subtitle {
            font-size: 1.125rem;
            text-align: center;
            color: #94a3b8; /* Slate 400 */
            max-width: 800px;
            margin: 0 auto 3rem auto;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .btn-primary {
            background-color: var(--agt-orange);
            color: white;
        }
        .btn-primary:hover {
            background-color: #FB923C; /* Orange 400 */
        }
        .btn-secondary {
            background-color: #334155; /* Slate 700 */
            color: var(--agt-text);
        }
        .btn-secondary:hover {
             background-color: #475569; /* Slate 600 */
        }
        .btn-active {
            background-color: var(--agt-orange);
            color: white;
            box-shadow: 0 0 15px rgba(249, 115, 22, 0.5);
        }
        .card {
            background-color: #1E293B; /* Slate 800 */
            border-radius: 0.75rem;
            padding: 1.5rem;
            border: 1px solid #334155; /* Slate 700 */
            height: 100%;
        }

        /* 3D Flip Card Styles */
        .flip-card {
            background-color: transparent;
            width: 100%;
            min-height: 220px;
            perspective: 1000px;
        }
        .chart-flip-card {
            height: 400px; /* Altura reducida para móviles (Mobile-first) */
        }
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }
        
        /* HOVER flip for informational cards */
        .hover-flip-card:hover .flip-card-inner {
            transform: rotateY(180deg);
        }

        /* CLICK flip for chart cards */
        .chart-flip-card.is-flipped .flip-card-inner {
            transform: rotateY(180deg);
        }

        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden; /* Safari */
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #1E293B; /* Slate 800 */
            border-radius: 0.75rem;
            border: 1px solid #334155; /* Slate 700 */
            padding: 1.5rem;
        }
        .flip-card-back {
            transform: rotateY(180deg);
        }
        .flip-trigger {
            position: absolute;
            top: 15px;
            right: 15px;
            cursor: pointer;
            z-index: 10;
            color: #94a3b8;
            transition: color 0.3s;
        }
        .flip-trigger:hover {
            color: var(--agt-orange);
        }

        .tooltip-container {
            position: relative;
        }
        .tooltip {
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tooltip-container:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        @media (min-width: 768px) {
            .chart-flip-card {
                height: 450px; /* Altura original para pantallas medianas y grandes */
            }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">

        <!-- HEADER -->
        <header class="mb-16 text-center">
            <img src="https://placehold.co/1200x400/0F172A/E2E8F0?text=AGT+OhmyFi" 
                 alt="Equipo de profesionales analizando datos en un entorno tecnológico"
                 class="w-full h-64 md:h-96 object-cover rounded-xl mb-8 opacity-75">
            <h1 class="text-4xl md:text-6xl font-extrabold mb-4 leading-tight">
                Transforme su Wi-Fi de un <span class="text-red-400">Gasto</span> a un <span class="text-green-400">Activo Estratégico</span>
            </h1>
            <p class="section-subtitle">Descubra cómo la solución OhmyFi + Zoho CRM, implementada por AGT, convierte su red de invitados en un motor de inteligencia de negocios y crecimiento para el mercado venezolano.</p>
        </header>

        <!-- DATA JOURNEY SECTION -->
        <section class="mb-20">
            <h2 class="section-title">El Viaje del Dato: De Conexión a Conversión</h2>
            <p class="section-subtitle">Visualice el flujo de valor. Así es como convertimos una simple conexión Wi-Fi en una relación rentable y medible con sus clientes.</p>
            <div class="grid grid-cols-1 md:grid-cols-5 gap-6 relative">
                
                <div class="flip-card hover-flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front card">
                             <i data-lucide="wifi" class="w-12 h-12 mb-4 text-orange-500"></i>
                             <h3 class="font-bold text-lg mb-2">1. Conexión</h3>
                             <p class="text-sm text-slate-400">El cliente se conecta al Wi-Fi gratuito a través de un portal cautivo personalizado.</p>
                        </div>
                        <div class="flip-card-back">
                             <h3 class="font-bold text-lg mb-2 text-orange-400">Portal de Marca</h3>
                             <p class="text-sm text-slate-300">El primer contacto es clave. Creamos un portal de acceso con su identidad de marca que ofrece una experiencia de conexión segura y profesional.</p>
                        </div>
                    </div>
                </div>
                <div class="flip-card hover-flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front card">
                            <i data-lucide="database" class="w-12 h-12 mb-4 text-orange-500"></i>
                            <h3 class="font-bold text-lg mb-2">2. Captura</h3>
                            <p class="text-sm text-slate-400">Se capturan datos de primera mano (First-Party Data) con consentimiento explícito.</p>
                        </div>
                        <div class="flip-card-back">
                            <h3 class="font-bold text-lg mb-2 text-orange-400">Activo de Datos</h3>
                            <p class="text-sm text-slate-300">Los "First-Party Data" son su activo más valioso: precisos, relevantes y obtenidos con consentimiento para una personalización efectiva y legal.</p>
                        </div>
                    </div>
                </div>
                <div class="flip-card hover-flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front card">
                            <i data-lucide="users" class="w-12 h-12 mb-4 text-orange-500"></i>
                            <h3 class="font-bold text-lg mb-2">3. Perfilamiento</h3>
                            <p class="text-sm text-slate-400">El perfil del cliente se crea o actualiza automáticamente en Zoho CRM.</p>
                        </div>
                         <div class="flip-card-back">
                            <h3 class="font-bold text-lg mb-2 text-orange-400">Inteligencia 360°</h3>
                            <p class="text-sm text-slate-300">La integración nativa con Zoho CRM enriquece el perfil del cliente, unificando su comportamiento online y offline para una visión completa.</p>
                        </div>
                    </div>
                </div>
                 <div class="flip-card hover-flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front card">
                            <i data-lucide="send" class="w-12 h-12 mb-4 text-orange-500"></i>
                            <h3 class="font-bold text-lg mb-2">4. Activación</h3>
                            <p class="text-sm text-slate-400">Se disparan campañas de marketing automatizadas y personalizadas.</p>
                        </div>
                        <div class="flip-card-back">
                           <h3 class="font-bold text-lg mb-2 text-orange-400">Marketing de Precisión</h3>
                           <p class="text-sm text-slate-300">La automatización permite impactar al cliente correcto en el momento oportuno con ofertas relevantes que impulsan la conversión.</p>
                        </div>
                    </div>
                </div>
                <div class="flip-card hover-flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front card">
                            <i data-lucide="bar-chart-2" class="w-12 h-12 mb-4 text-orange-500"></i>
                            <h3 class="font-bold text-lg mb-2">5. Medición</h3>
                            <p class="text-sm text-slate-400">Se mide el ROI, LTV y el impacto real de cada interacción en las ventas.</p>
                        </div>
                        <div class="flip-card-back">
                            <h3 class="font-bold text-lg mb-2 text-orange-400">Cierre del Ciclo</h3>
                            <p class="text-sm text-slate-300">La solución permite atribuir ventas a las campañas de WiFi Marketing, demostrando el valor tangible y el ROI. Dejamos de adivinar y empezamos a medir.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SIMULATOR SECTION -->
        <section id="simulator" class="mb-24">
             <div class="flex flex-col md:flex-row justify-between items-center mb-8">
                <div class="text-center md:text-left mb-6 md:mb-0">
                    <h2 class="section-title !text-left !mb-0">Simulador Financiero Interactivo</h2>
                    <p class="section-subtitle !text-left !ml-0 max-w-2xl">Ajuste las variables y proyecte el impacto financiero real. Compare dos escenarios clave para el mercado venezolano.</p>
                </div>
                <button id="generate-report-btn" class="btn btn-primary"><i data-lucide="download" class="w-5 h-5 mr-2"></i>Generar Informe PDF</button>
            </div>
            
            <div class="text-center mb-8">
                <button id="btn-completa" class="btn btn-active mr-4">Escenario 1: Solución Completa (AGT)</button>
                <button id="btn-byod" class="btn btn-secondary">Escenario 2: Infraestructura Propia (BYOD)</button>
            </div>

            <!-- Panel de Control Horizontal -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                <!-- Panel 1: Infraestructura -->
                <div class="card bg-slate-800/50">
                    <h3 class="text-xl font-bold mb-4 text-orange-400 flex items-center">
                        <span class="bg-orange-500 text-white rounded-full h-8 w-8 flex items-center justify-center mr-3 text-sm font-bold">1</span>
                        Infraestructura
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block mb-2 text-sm font-medium">APs Interiores</label>
                            <input type="number" id="aps-indoor" value="3" min="0" class="w-full p-2 rounded bg-slate-700 border border-slate-600 focus:ring-orange-500 focus:border-orange-500">
                        </div>
                        <div>
                            <label class="block mb-2 text-sm font-medium">APs Exteriores</label>
                            <input type="number" id="aps-outdoor" value="1" min="0" class="w-full p-2 rounded bg-slate-700 border border-slate-600 focus:ring-orange-500 focus:border-orange-500">
                        </div>
                    </div>
                </div>

                <!-- Panel 2: Métricas de Negocio -->
                <div class="card bg-slate-800/50">
                    <h3 class="text-xl font-bold mb-4 text-orange-400 flex items-center">
                       <span class="bg-orange-500 text-white rounded-full h-8 w-8 flex items-center justify-center mr-3 text-sm font-bold">2</span>
                       Métricas de Negocio
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block mb-2 text-sm font-medium">Valor de Vida del Cliente (LTV)</label>
                            <input type="number" id="customer-ltv" value="50" min="0" class="w-full p-2 rounded bg-slate-700 border border-slate-600 focus:ring-orange-500 focus:border-orange-500">
                        </div>
                    </div>
                </div>
                
                <!-- Panel 3: Costos y Financiamiento -->
                <div class="card bg-slate-800/50">
                     <h3 class="text-xl font-bold mb-4 text-orange-400 flex items-center">
                       <span class="bg-orange-500 text-white rounded-full h-8 w-8 flex items-center justify-center mr-3 text-sm font-bold">3</span>
                       Costos y Financiamiento
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block mb-2 text-sm font-medium">Costo Mensual de Internet</label>
                            <input type="number" id="internet-cost" value="100" min="0" class="w-full p-2 rounded bg-slate-700 border border-slate-600 focus:ring-orange-500 focus:border-orange-500">
                        </div>
                        <div id="financing-section">
                            <label for="financing-term" class="block mb-2 text-sm font-medium">Plazo de Financiamiento: <span id="financing-term-value" class="font-bold text-orange-400">0</span> meses</label>
                            <input type="range" id="financing-term" min="0" max="3" value="0" step="1" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Unificado a Ancho Completo -->
            <div id="dashboard" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Fila de KPIs -->
                <div class="card text-center md:col-span-1">
                    <h3 class="text-lg font-semibold text-slate-400">Retorno de la Inversión (ROI)</h3>
                    <p id="roi-value" class="text-5xl font-extrabold text-green-400 my-2">0%</p>
                </div>
                <div class="card text-center md:col-span-1">
                     <h3 class="text-lg font-semibold text-slate-400">Costo Total de Propiedad (TCO)</h3>
                    <p id="tco-value" class="text-4xl font-bold text-red-400 my-2">$0</p>
                </div>
                <div class="card text-center md:col-span-1">
                    <h3 class="text-lg font-semibold text-slate-400">Período de Recuperación</h3>
                    <p id="payback-value" class="text-4xl font-bold text-blue-400 my-2">0 Meses</p>
                </div>

                <!-- Banner de Análisis de Payback -->
                <div class="card md:col-span-3">
                    <p id="payback-text" class="text-sm text-slate-300 text-center"></p>
                </div>

                <!-- Fila de Gráficos -->
                 <div class="flip-card chart-flip-card md:col-span-1">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                             <i data-lucide="info" class="flip-trigger"></i>
                            <h3 class="font-bold mb-2">Desglose TCO (CAPEX vs OPEX)</h3>
                            <canvas id="tcoBreakdownChart"></canvas>
                        </div>
                        <div class="flip-card-back">
                            <h3 class="font-bold text-xl mb-4 text-orange-400">Entendiendo el TCO</h3>
                            <p class="text-base text-slate-300 mb-6">Muestra la proporción de su inversión entre costos iniciales **(CAPEX)** y costos operativos **(OPEX)**. Clave para una planificación financiera precisa.</p>
                            <button class="btn btn-secondary flip-back-trigger"><i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>Volver</button>
                        </div>
                    </div>
                </div>

                 <div class="flip-card chart-flip-card md:col-span-2">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                             <i data-lucide="info" class="flip-trigger"></i>
                            <h3 class="font-bold mb-2">Desglose TCO (por Componente)</h3>
                            <canvas id="tcoComponentBreakdownChart"></canvas>
                        </div>
                        <div class="flip-card-back">
                            <h3 class="font-bold text-xl mb-4 text-orange-400">¿En qué se invierte?</h3>
                            <p class="text-base text-slate-300 mb-6">Este gráfico desglosa el costo total en sus componentes principales: **Hardware**, **Servicios de Implementación** y **Licenciamiento y Soporte** a lo largo de 3 años.</p>
                            <button class="btn btn-secondary flip-back-trigger"><i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>Volver</button>
                        </div>
                    </div>
                </div>

                 <div class="flip-card chart-flip-card md:col-span-2">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                             <i data-lucide="info" class="flip-trigger"></i>
                            <h3 class="font-bold mb-2">Evolución de Costos Mensuales</h3>
                            <canvas id="monthlyCostsChart"></canvas>
                        </div>
                        <div class="flip-card-back">
                            <h3 class="font-bold text-xl mb-4 text-orange-400">Estructura de Costos</h3>
                            <p class="text-base text-slate-300 mb-6">Este gráfico desglosa los costos a lo largo del tiempo. Muestra la **inversión inicial**, las **cuotas de financiamiento** (si aplica) y los **costos operativos recurrentes**.</p>
                            <button class="btn btn-secondary flip-back-trigger"><i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>Volver</button>
                        </div>
                    </div>
                </div>

                <div class="flip-card chart-flip-card md:col-span-1">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                             <i data-lucide="info" class="flip-trigger"></i>
                            <h3 class="font-bold mb-2">Flujo de Caja Acumulado</h3>
                            <canvas id="cumulativeCashflowChart"></canvas>
                        </div>
                        <div class="flip-card-back">
                            <h3 class="font-bold text-xl mb-4 text-orange-400">Camino a la Rentabilidad</h3>
                            <p class="text-base text-slate-300 mb-6">Muestra el balance neto mes a mes. Comienza con el desemso inicial y crece hasta cruzar el cero en el mes del Payback, momento en que la inversión ha sido recuperada.</p>
                            <button class="btn btn-secondary flip-back-trigger"><i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>Volver</button>
                        </div>
                    </div>
                </div>
                
                <div class="flip-card chart-flip-card md:col-span-3">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                             <i data-lucide="info" class="flip-trigger"></i>
                            <h3 class="font-bold mb-2">Simulación Monte Carlo del ROI (Análisis de Riesgo)</h3>
                            <canvas id="monteCarloChart"></canvas>
                        </div>
                        <div class="flip-card-back">
                            <h3 class="font-bold text-xl mb-4 text-orange-400">Análisis de Sensibilidad</h3>
                            <p class="text-base text-slate-300 mb-6">Esta simulación ejecuta 10,000 escenarios variando LTV y Conversión para medir la resiliencia del ROI. Un resultado concentrado en valores altos indica una inversión de bajo riesgo.</p>
                            <button class="btn btn-secondary flip-back-trigger"><i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>Volver</button>
                        </div>
                    </div>
                </div>

                <div class="flip-card chart-flip-card md:col-span-2">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                             <i data-lucide="info" class="flip-trigger"></i>
                            <h3 class="font-bold mb-2">Ingresos vs Costos (Crossover)</h3>
                            <canvas id="crossoverChart"></canvas>
                        </div>
                        <div class="flip-card-back">
                            <h3 class="font-bold text-xl mb-4 text-orange-400">Punto de Equilibrio</h3>
                            <p class="text-base text-slate-300 mb-6">Este gráfico muestra el momento exacto en que los ingresos acumulados (verde) superan a los costos acumulados (naranja), marcando el punto de equilibrio de la inversión.</p>
                            <button class="btn btn-secondary flip-back-trigger"><i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>Volver</button>
                        </div>
                    </div>
                </div>
                
                <div class="flip-card chart-flip-card md:col-span-1">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                             <i data-lucide="info" class="flip-trigger"></i>
                            <h3 class="font-bold mb-2">Componentes del ROI</h3>
                            <canvas id="roiComponentsChart"></canvas>
                        </div>
                        <div class="flip-card-back">
                            <h3 class="font-bold text-xl mb-4 text-orange-400">¿De dónde viene el ROI?</h3>
                            <p class="text-base text-slate-300 mb-6">Compara directamente el Costo Total de Propiedad (TCO) con los ingresos totales generados. La diferencia positiva entre ambas barras representa el beneficio neto.</p>
                            <button class="btn btn-secondary flip-back-trigger"><i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>Volver</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SIGNIFICADOS SECTION -->
        <section id="glossary" class="mb-16">
            <h2 class="section-title">Glosario Financiero</h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                 <div class="flip-card hover-flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front card">
                            <h3 class="font-bold text-lg text-orange-400 mb-2">Retorno de la Inversión (ROI)</h3>
                            <p class="text-sm text-slate-300">Mide la ganancia o pérdida generada en relación con el monto invertido.</p>
                        </div>
                        <div class="flip-card-back">
                           <p class="text-sm text-slate-300">Un ROI alto indica alta rentabilidad. Es el indicador final del éxito financiero de una inversión.</p>
                        </div>
                    </div>
                </div>
                 <div class="flip-card hover-flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front card">
                            <h3 class="font-bold text-lg text-orange-400 mb-2">Costo Total de Propiedad (TCO)</h3>
                            <p class="text-sm text-slate-300">Cálculo de todos los costos de la solución en su vida útil (3 años).</p>
                        </div>
                        <div class="flip-card-back">
                            <p class="text-sm text-slate-300">Incluye costos directos (hardware, licencias) e indirectos (soporte, mantenimiento), ofreciendo una visión completa de la inversión.</p>
                        </div>
                    </div>
                </div>
                <div class="flip-card hover-flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front card">
                            <h3 class="font-bold text-lg text-orange-400 mb-2">Período de Recuperación</h3>
                            <p class="text-sm text-slate-300">El tiempo necesario para que los ingresos generados igualen la inversión.</p>
                        </div>
                        <div class="flip-card-back">
                           <p class="text-sm text-slate-300">Un período de recuperación (Payback) corto es ideal, ya que indica que la inversión comienza a generar ganancias netas rápidamente.</p>
                        </div>
                    </div>
                </div>
                <div class="flip-card hover-flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front card">
                           <h3 class="font-bold text-lg text-orange-400 mb-2">Valor de Vida del Cliente (LTV)</h3>
                           <p class="text-sm text-slate-300">La ganancia neta total que se espera de un cliente durante toda su relación comercial.</p>
                        </div>
                        <div class="flip-card-back">
                           <p class="text-sm text-slate-300">Aumentar el LTV es un objetivo clave. Esta solución lo potencia a través del marketing de fidelización y la re-compra.</p>
                        </div>
                    </div>
                </div>
                 <div class="flip-card hover-flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front card">
                           <h3 class="font-bold text-lg text-orange-400 mb-2">CAPEX</h3>
                           <p class="text-sm text-slate-300">Gastos en activos fijos (Capital Expenditures), como el hardware. Es una inversión inicial.</p>
                        </div>
                         <div class="flip-card-back">
                           <p class="text-sm text-slate-300">Se realiza una sola vez y se deprecia con el tiempo. Distinto de los gastos operativos recurrentes.</p>
                        </div>
                    </div>
                </div>
                <div class="flip-card hover-flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front card">
                            <h3 class="font-bold text-lg text-orange-400 mb-2">OPEX</h3>
                            <p class="text-sm text-slate-300">Gastos operativos continuos (Operational Expenditures), como licencias y soporte.</p>
                        </div>
                        <div class="flip-card-back">
                            <p class="text-sm text-slate-300">Son los costos recurrentes para mantener la solución funcionando. Son predecibles y se presupuestan anualmente.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <footer class="text-center py-8 border-t border-slate-700">
            <p class="text-slate-400">Simulador Financiero v16.6 | Desarrollado por Gemini para AGT Comunidades</p>
        </footer>

    </div>

    <!-- PDF Report Modal -->
    <div id="report-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 transition-opacity duration-300 opacity-0 pointer-events-none">
        <div class="bg-slate-800 rounded-lg shadow-xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-orange-400">Resumen Ejecutivo de la Simulación</h2>
                <button id="report-close-btn" class="text-slate-400 hover:text-white">&times;</button>
            </div>
            <div class="bg-slate-900 p-4 rounded-md mb-6">
                <pre id="report-content" class="text-sm text-slate-300 whitespace-pre-wrap font-mono"></pre>
            </div>
            <div class="text-right">
                <button id="report-download-btn" class="btn btn-primary"><i data-lucide="download" class="w-5 h-5 mr-2"></i>Descargar PDF</button>
            </div>
        </div>
    </div>

<script>
    // V16.6 CALCULATION ENGINE - v6 Payback Logic Restored
    const PRICING = {
        // 1. Costos de Inversión Inicial (Hardware)
        CONTROLLER_COST: 179.00,
        AP_INDOOR_COST: 95.00,
        AP_OUTDOOR_COST: 144.00,
        HARDWARE_MARKUP: 0.25, // 25%

        // 1. Costos de Inversión Inicial (Servicios)
        AUX_COMPONENTS_FIXED: 850.00,
        INSTALL_FEE_PER_AP: 75.00,
        CONFIG_FEE_FIXED: 200.00,
        BYOD_CONFIG_FEE_FIXED: 1000.00, 

        // 2. Costos Recurrentes Mensuales
        LICENSE_OHMYFI_PER_AP_MONTHLY: 16.00,
        LICENSE_ZOHO_FIXED_MONTHLY: 50.00,

        // Modelo de Financiamiento (Tasas Totales sobre CAPEX)
        FINANCING_RATES: { "0": 0, "1": 0.25, "2": 0.30, "3": 0.35 }
    };

    const ROI_PARAMS = {
        CONVERSION_RATE: 0.10, // v6 Logic
        LEADS_PER_AP: 25      // v6 Logic
    };

    const ui = {
        buttons: { completa: document.getElementById('btn-completa'), byod: document.getElementById('btn-byod') },
        inputs: { 
            apsIndoor: document.getElementById('aps-indoor'), 
            apsOutdoor: document.getElementById('aps-outdoor'), 
            customerLTV: document.getElementById('customer-ltv'), 
            internetCost: document.getElementById('internet-cost'),
        },
        financing: { section: document.getElementById('financing-section'), slider: document.getElementById('financing-term'), valueLabel: document.getElementById('financing-term-value') },
        outputs: { roi: { value: document.getElementById('roi-value') }, tco: { value: document.getElementById('tco-value') }, payback: { value: document.getElementById('payback-value'), text: document.getElementById('payback-text') } },
        report: { modal: document.getElementById('report-modal'), generateBtn: document.getElementById('generate-report-btn'), closeBtn: document.getElementById('report-close-btn'), downloadBtn: document.getElementById('report-download-btn'), content: document.getElementById('report-content') }
    };

    let currentScenario = 'completa';
    let charts = {};
    let lastCalculationData = {};

    function initialize() {
        setupEventListeners();
        createCharts();
        setScenario('completa');
    }

    function setupEventListeners() {
        ui.buttons.completa.addEventListener('click', () => setScenario('completa'));
        ui.buttons.byod.addEventListener('click', () => setScenario('byod'));
        Object.values(ui.inputs).forEach(input => input.addEventListener('input', calculate));
        ui.financing.slider.addEventListener('input', () => { ui.financing.valueLabel.textContent = ui.financing.slider.value; calculate(); });

        document.querySelectorAll('.chart-flip-card').forEach(card => {
            const trigger = card.querySelector('.flip-trigger');
            const backTrigger = card.querySelector('.flip-back-trigger');
            if(trigger) { trigger.addEventListener('click', (e) => { e.stopPropagation(); card.classList.add('is-flipped'); }); }
            if(backTrigger) { backTrigger.addEventListener('click', (e) => { e.stopPropagation(); card.classList.remove('is-flipped'); }); }
        });
        
        ui.report.generateBtn.addEventListener('click', () => { ui.report.content.textContent = generateReportText(lastCalculationData); ui.report.modal.classList.remove('opacity-0', 'pointer-events-none'); });
        ui.report.closeBtn.addEventListener('click', () => ui.report.modal.classList.add('opacity-0', 'pointer-events-none'));
        ui.report.downloadBtn.addEventListener('click', () => downloadPDF(lastCalculationData));
        lucide.createIcons();
    }

    function setScenario(scenario) {
        currentScenario = scenario;
        ui.buttons.completa.classList.toggle('btn-active', scenario === 'completa');
        ui.buttons.completa.classList.toggle('btn-secondary', scenario !== 'completa');
        ui.buttons.byod.classList.toggle('btn-active', scenario === 'byod');
        ui.buttons.byod.classList.toggle('btn-secondary', scenario !== 'byod');
        ui.financing.section.style.display = scenario === 'completa' ? 'block' : 'none';
        
        calculate();
    }

    function calculate() {
        try {
            const values = {
                apsIndoor: parseInt(ui.inputs.apsIndoor.value) || 0,
                apsOutdoor: parseInt(ui.inputs.apsOutdoor.value) || 0,
                customerLTV: parseFloat(ui.inputs.customerLTV.value) || 0,
                internetCost: parseFloat(ui.inputs.internetCost.value) || 0,
                financingTerm: parseInt(ui.financing.slider.value, 10) || 0
            };

            const totalAps = values.apsIndoor + values.apsOutdoor;

            let hardwarePrice = 0, servicesPrice = 0, capex = 0;
            if (currentScenario === 'completa') {
                const hardwareBaseCost = PRICING.CONTROLLER_COST + (values.apsIndoor * PRICING.AP_INDOOR_COST) + (values.apsOutdoor * PRICING.AP_OUTDOOR_COST);
                hardwarePrice = hardwareBaseCost * (1 + PRICING.HARDWARE_MARKUP);
                servicesPrice = PRICING.AUX_COMPONENTS_FIXED + PRICING.CONFIG_FEE_FIXED + (totalAps * PRICING.INSTALL_FEE_PER_AP);
                capex = hardwarePrice + servicesPrice;
            } else { // byod
                capex = PRICING.BYOD_CONFIG_FEE_FIXED;
                servicesPrice = capex;
            }

            const monthlyLicenseCost = (totalAps * PRICING.LICENSE_OHMYFI_PER_AP_MONTHLY) + PRICING.LICENSE_ZOHO_FIXED_MONTHLY;
            const monthlyOpex = monthlyLicenseCost + values.internetCost;
            const totalOpex = monthlyOpex * 36;
            
            let financingCost = 0;
            let monthlyFinancingPayment = 0;
            if (currentScenario === 'completa' && values.financingTerm > 0) {
                const rate = PRICING.FINANCING_RATES[values.financingTerm];
                financingCost = capex * rate;
                monthlyFinancingPayment = (capex + financingCost) / values.financingTerm;
            }
            
            const tco = capex + totalOpex + financingCost;
            const newCustomersMonthly = totalAps * ROI_PARAMS.LEADS_PER_AP * ROI_PARAMS.CONVERSION_RATE;
            const monthlyRevenue = newCustomersMonthly * values.customerLTV;
            const totalRevenue = monthlyRevenue * 36;
            const netBenefit = totalRevenue - tco;
            const roi = tco > 0 ? (netBenefit / tco) : 0;
            
            const effectiveInitialOutlay = (currentScenario === 'completa' && values.financingTerm > 0) ? 0 : capex;
            let cumulativeNet = -effectiveInitialOutlay;
            let paybackPeriod = -1;
            const monthlyData = { costs: [], revenues: [], opex: [], capex: [], cumulativeNet: [] };

            for (let month = 1; month <= 36; month++) {
                const currentMonthCost = monthlyOpex + (month <= values.financingTerm ? monthlyFinancingPayment : 0);
                cumulativeNet += monthlyRevenue - currentMonthCost;
                
                if (cumulativeNet >= 0 && paybackPeriod === -1) {
                    paybackPeriod = month;
                }

                // For charts
                const cumulativeCostForChart = effectiveInitialOutlay + (monthlyOpex * month) + (Math.min(month, values.financingTerm) * monthlyFinancingPayment);
                monthlyData.revenues.push(monthlyRevenue * month);
                monthlyData.costs.push(cumulativeCostForChart);
                monthlyData.opex.push(currentMonthCost);
                monthlyData.capex.push(month === 1 ? effectiveInitialOutlay : 0);
                monthlyData.cumulativeNet.push(cumulativeNet);
            }

            const tcoComponents = {
                hardware: hardwarePrice,
                services: servicesPrice,
                licenses: totalOpex
            };
            
            const monteCarloResults = runMonteCarlo(values, totalAps, capex, monthlyOpex, financingCost);
            lastCalculationData = { ...values, totalAps, capex, tco, totalRevenue, netBenefit, roi, paybackPeriod, totalOpex, financingCost, monthlyFinancingPayment, scenario: currentScenario, monteCarloResults, monthlyData, tcoComponents };
            
            updateUI(lastCalculationData);
        } catch (error) {
            console.error("Calculation failed:", error);
        }
    }
    
    function runMonteCarlo(values, totalAps, capex, monthlyOpex, financingCost) {
        const simulations = 10000;
        const results = [];
        const totalOpexSim = monthlyOpex * 36;
        for (let i = 0; i < simulations; i++) {
            const ltvVar = values.customerLTV * (0.8 + Math.random() * 0.4); // +/- 20%
            const convRateVar = ROI_PARAMS.CONVERSION_RATE * (0.8 + Math.random() * 0.4); // +/- 20%
            const leadsPerApVar = ROI_PARAMS.LEADS_PER_AP * (0.8 + Math.random() * 0.4);
            const newCustMonthVar = totalAps * leadsPerApVar * convRateVar;
            const totalRevVar = newCustMonthVar * 36 * ltvVar;
            const tcoVar = capex + totalOpexSim + financingCost;
            const netBenefitVar = totalRevVar - tcoVar;
            const roiVar = tcoVar > 0 ? (netBenefitVar / tcoVar) : 0;
            results.push(roiVar);
        }
        return results;
    }

    function updateUI(d) {
        const formatCurrency = (val) => `$${val.toLocaleString('en-US', {maximumFractionDigits:0})}`;
        ui.outputs.roi.value.textContent = `${(d.roi * 100).toFixed(0)}%`;
        ui.outputs.tco.value.textContent = formatCurrency(d.tco);
        ui.outputs.payback.value.textContent = d.paybackPeriod > 0 ? `${d.paybackPeriod} Meses` : "N/A";
        
        if(d.paybackPeriod > 0) {
            if(d.financingTerm > 0){
                const totalFinanced = d.capex + d.financingCost;
                ui.outputs.payback.text.innerHTML = `
                    Al optar por el financiamiento, se evita el desembolso inicial de ${formatCurrency(d.capex)}. En su lugar, la inversión se cubre con <strong>${d.financingTerm} cuotas de ${formatCurrency(d.monthlyFinancingPayment)}</strong>.
                    <br>Este modelo protege su liquidez, y es la razón por la que el punto de equilibrio se alcanza en <strong>${d.paybackPeriod} meses</strong>.
                `;
            } else {
                ui.outputs.payback.text.textContent = `La inversión se recupera y empieza a generar ganancias en el mes ${d.paybackPeriod}.`;
            }
        } else {
            ui.outputs.payback.text.textContent = 'Los ingresos no cubren la inversión en 3 años.';
        }
        
        updateCharts(d);
    }

    function createCharts() {
        const chartOptions = { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: 'white' } } }, scales: { x: { ticks: { color: 'white' }, grid: { color: '#334155' } }, y: { ticks: { color: 'white' }, grid: { color: '#334155' } } } };
        
        try {
            charts.tcoBreakdown = new Chart(document.getElementById('tcoBreakdownChart').getContext('2d'), { type: 'doughnut', data: { labels: ['Inversión Inicial (CAPEX)', 'Costos Operativos (OPEX)'], datasets: [{ data: [], backgroundColor: ['#3B82F6', '#F97316'] }] }, options: { ...chartOptions, scales: {} } });
        } catch (e) { console.error("Failed to create tcoBreakdownChart:", e); }

        try {
            charts.tcoComponentBreakdown = new Chart(document.getElementById('tcoComponentBreakdownChart').getContext('2d'), { type: 'doughnut', data: { labels: ['Hardware', 'Servicios', 'Licencias y Soporte'], datasets: [{ data: [], backgroundColor: ['#3B82F6', '#10B981', '#F97316'] }] }, options: { ...chartOptions, scales: {} } });
        } catch (e) { console.error("Failed to create tcoComponentBreakdownChart:", e); }

        try {
            charts.cumulativeCashflow = new Chart(document.getElementById('cumulativeCashflowChart').getContext('2d'), { type: 'line', data: { labels: Array.from({ length: 36 }, (_, i) => i + 1), datasets: [{ label: 'Flujo de Caja Acumulado', data: [], borderColor: '#22C55E', tension: 0.1, fill: true, backgroundColor: 'rgba(34, 197, 94, 0.2)' }] }, options: { ...chartOptions, scales: { ...chartOptions.scales, x: { ...chartOptions.scales.x, title: { display: true, text: 'Meses', color:'white' } } } } });
        } catch (e) { console.error("Failed to create cumulativeCashflowChart:", e); }

        try {
            charts.monthlyCosts = new Chart(document.getElementById('monthlyCostsChart').getContext('2d'), { type: 'bar', data: { labels: Array.from({ length: 12 }, (_, i) => `Mes ${i+1}`), datasets: [{ label: 'OPEX + Financiamiento', data: [], backgroundColor: '#F97316' }, { label: 'CAPEX (Mes 1)', data: [], backgroundColor: '#3B82F6' }] }, options: { ...chartOptions, scales: { ...chartOptions.scales, x: { stacked: true }, y: { stacked: true } } } });
        } catch (e) { console.error("Failed to create monthlyCostsChart:", e); }

        try {
            charts.monteCarlo = new Chart(document.getElementById('monteCarloChart').getContext('2d'), { type: 'bar', data: { labels: [], datasets: [{ label: 'Frecuencia', data: [], backgroundColor: '#8B5CF6' }] }, options: { ...chartOptions, scales: { ...chartOptions.scales, x: { ...chartOptions.scales.x, title: { display: true, text: 'Rango de ROI (%)', color:'white' } }, y: { ...chartOptions.scales.y, title: { display: true, text: 'Nº de Simulaciones', color:'white' } } } } });
        } catch (e) { console.error("Failed to create monteCarloChart:", e); }

        try {
            charts.crossover = new Chart(document.getElementById('crossoverChart').getContext('2d'), { type: 'line', data: { labels: Array.from({ length: 36 }, (_, i) => i + 1), datasets: [{ label: 'Costos Acumulados', data: [], borderColor: '#F97316', fill: true, backgroundColor: 'rgba(249, 115, 22, 0.2)', tension: 0.1 }, { label: 'Ingresos Acumulados', data: [], borderColor: '#22C55E', fill: true, backgroundColor: 'rgba(34, 197, 94, 0.2)', tension: 0.1 }] }, options: { ...chartOptions, scales: { ...chartOptions.scales, x: { ...chartOptions.scales.x, title: { display: true, text: 'Meses', color:'white' } } } } });
        } catch(e) { console.error("Failed to create crossoverChart:", e); }

        try {
            charts.roiComponents = new Chart(document.getElementById('roiComponentsChart').getContext('2d'), { type: 'bar', data: { labels: ['Costo Total (TCO)', 'Ingreso Total'], datasets: [{ data: [], backgroundColor: ['#DC2626', '#22C55E'], label: 'Monto en USD' }] }, options: { ...chartOptions, plugins: { legend: { display: false } } } });
        } catch(e) { console.error("Failed to create roiComponentsChart:", e); }
    }

    function updateCharts(d) {
        try {
            if (charts.tcoBreakdown) {
                charts.tcoBreakdown.data.datasets[0].data = [d.capex + d.financingCost, d.totalOpex];
                charts.tcoBreakdown.update();
            }
        } catch (e) { console.error("Failed to update tcoBreakdownChart:", e); }

        try {
            if (charts.tcoComponentBreakdown) {
                charts.tcoComponentBreakdown.data.datasets[0].data = [d.tcoComponents.hardware, d.tcoComponents.services, d.tcoComponents.licenses];
                charts.tcoComponentBreakdown.update();
            }
        } catch (e) { console.error("Failed to update tcoComponentBreakdownChart:", e); }
        
        try {
            if (charts.cumulativeCashflow) {
                charts.cumulativeCashflow.data.datasets[0].data = d.monthlyData.cumulativeNet;
                charts.cumulativeCashflow.update();
            }
        } catch (e) { console.error("Failed to update cumulativeCashflowChart:", e); }

        try {
            if (charts.monthlyCosts) {
                charts.monthlyCosts.data.datasets[0].data = d.monthlyData.opex.slice(0, 12);
                charts.monthlyCosts.data.datasets[1].data = d.monthlyData.capex.slice(0, 12);
                charts.monthlyCosts.update();
            }
        } catch (e) { console.error("Failed to update monthlyCostsChart:", e); }

        try {
            if (charts.monteCarlo) {
                const bins = {};
                const binSize = 0.5; // 50%
                d.monteCarloResults.forEach(roi => {
                    const bin = Math.floor(roi / binSize) * binSize;
                    bins[bin] = (bins[bin] || 0) + 1;
                });
                const sortedBins = Object.keys(bins).map(parseFloat).sort((a, b) => a - b);
                charts.monteCarlo.data.labels = sortedBins.map(bin => `${(bin*100).toFixed(0)}% a ${((bin + binSize)*100).toFixed(0)}%`);
                charts.monteCarlo.data.datasets[0].data = sortedBins.map(bin => bins[bin]);
                charts.monteCarlo.update();
            }
        } catch (e) { console.error("Failed to update monteCarloChart:", e); }

        try {
            if (charts.crossover) {
                charts.crossover.data.datasets[0].data = d.monthlyData.costs;
                charts.crossover.data.datasets[1].data = d.monthlyData.revenues;
                charts.crossover.update();
            }
        } catch (e) { console.error("Failed to update crossoverChart:", e); }

        try {
            if (charts.roiComponents) {
                charts.roiComponents.data.datasets[0].data = [d.tco, d.totalRevenue];
                charts.roiComponents.update();
            }
        } catch (e) { console.error("Failed to update roiComponentsChart:", e); }
    }
    
    function generateReportText(d) {
        const scenarioText = d.scenario === 'completa' ? 'Solución Completa (AGT)' : 'Infraestructura Propia (BYOD)';
        let financingText = '';
        if (d.financingTerm > 0) {
            financingText = `
DETALLES DEL FINANCIAMIENTO:
---------------------------
- Costo Total Financiado: $${(d.capex + d.financingCost).toLocaleString('en-US', {maximumFractionDigits:2})}
- Plazo: ${d.financingTerm} cuotas mensuales
- Monto de cada cuota: $${d.monthlyFinancingPayment.toLocaleString('en-US', {maximumFractionDigits:2})}
`;
        }

        return `
INFORME DE ANÁLISIS FINANCIERO - SOLUCIÓN AGT OHMYFI
=====================================================
Fecha: ${new Date().toLocaleDateString('es-VE')}
Escenario Simulado: ${scenarioText}

PARÁMETROS DE ENTRADA:
----------------------
- APs Interiores: ${d.apsIndoor}, APs Exteriores: ${d.apsOutdoor}, Total APs: ${d.totalAps}
- Valor de Vida del Cliente (LTV): $${d.customerLTV.toLocaleString()}
- Costo Mensual de Internet: $${d.internetCost.toLocaleString()}
${d.scenario === 'completa' ? `- Plazo de Financiamiento: ${d.financingTerm} meses` : ''}

RESULTADOS PROYECTADOS A 3 AÑOS:
--------------------------------
- INVERSIÓN INICIAL (CAPEX): $${d.capex.toLocaleString('en-US', {maximumFractionDigits:2})}
- COSTOS OPERATIVOS TOTALES (OPEX): $${d.totalOpex.toLocaleString('en-US', {maximumFractionDigits:2})}
${d.financingCost > 0 ? `- COSTO DE FINANCIAMIENTO: $${d.financingCost.toLocaleString('en-US', {maximumFractionDigits:2})}` : ''}

- COSTO TOTAL DE PROPIEDAD (TCO): $${d.tco.toLocaleString('en-US', {maximumFractionDigits:2})}
- INGRESOS TOTALES GENERADOS: $${d.totalRevenue.toLocaleString('en-US', {maximumFractionDigits:2})}
- BENEFICIO NETO: $${d.netBenefit.toLocaleString('en-US', {maximumFractionDigits:2})}

INDICADORES CLAVE DE RENDIMIENTO (KPI):
---------------------------------------
- RETORNO DE LA INVERSIÓN (ROI): ${(d.roi * 100).toFixed(0)}%
- PERÍODO DE RECUPERACIÓN (PAYBACK): ${d.paybackPeriod > 0 ? `${d.paybackPeriod} meses` : 'No se recupera en 36 meses'}
${financingText}
CONCLUSIÓN:
-----------
Bajo los parámetros especificados, la implementación representa una inversión ${d.roi > 0 ? 'altamente rentable y de bajo riesgo' : 'que requiere revisión'}. El capital invertido se recuperaría en ${d.paybackPeriod > 0 ? `${d.paybackPeriod} meses` : 'más de 3 años'}, generando un retorno del ${(d.roi * 100).toFixed(0)}% sobre el costo total.
`;
    }

    function downloadPDF(d) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const reportText = generateReportText(d);
        doc.setFont('courier', 'normal');
        doc.setFontSize(10);
        doc.text(reportText, 10, 10);
        doc.save(`Reporte_OhmyFi_${d.scenario}_${new Date().toISOString().slice(0,10)}.pdf`);
    }

    window.onload = initialize;
</script>
</body>
</html>

