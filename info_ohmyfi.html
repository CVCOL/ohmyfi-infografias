<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infografía Interactiva: OhmyFi - AGT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!--
CONTROL DE VERSIONES: Simulador Interactivo OhmyFi
===================================================
Este bloque registra la evolución del proyecto, manteniendo un historial
de las últimas tres versiones estables para referencia rápida.

Versión: 37.5 (11/10/2025)
- Título: Corrección de Regresión del Dashboard y Fusión Final
- Cambios:
  1.  Se restauró el dashboard completo del simulador a partir de la v36.9,
      incluyendo todos los KPIs de rentabilidad (ROI, TCO, etc.) y la
      grilla completa de gráficos interactivos de análisis profundo.
  2.  Se fusionó con éxito el motor de cálculo evolucionado (v37.4),
      integrando los nuevos KPIs ("Ahorro Anual", "Clientes Leales")
      en una nueva sección superior para una narrativa de valor jerárquizada.
  3.  Se corrigió la regresión funcional que impedía la visualización
      del análisis financiero.
  4.  Se actualizó el pie de página a la versión 37.5.

Versión: 37.4 (11/10/2025)
- Título: Fusión Final de Motor de Cálculo y Dashboard Completo
- Cambios:
  1.  Se restauró el dashboard completo del simulador, incluyendo todos los
      KPIs de rentabilidad (ROI, TCO, etc.) y la grilla completa de
      gráficos interactivos de análisis profundo.
  2.  Se implementó con éxito el nuevo motor de cálculo, integrando los
      nuevos KPIs ("Ahorro Anual", "Clientes Leales") en la parte superior
      del dashboard restaurado para una narrativa de valor más clara.
  3.  Se actualizaron el panel de control, el glosario y el reporte PDF
      para reflejar de forma consistente el nuevo modelo de valor.
  4.  Se actualizó el pie de página a la versión 37.4.

Versión: 37.3 (11/10/2025)
- Título: Fusión de Motor de Cálculo Evolucionado con Dashboard Completo
- Cambios:
  1.  Se restauró el dashboard completo del simulador, incluyendo todos los
      KPIs de rentabilidad (ROI, TCO, etc.) y la grilla completa de
      gráficos interactivos de análisis profundo.
  2.  Se implementó con éxito el nuevo motor de cálculo, integrando los
      nuevos KPIs ("Ahorro Anual", "Clientes Leales") en la parte superior
      del dashboard restaurado para una narrativa de valor más clara.

    -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Color de fondo suave */
        }
        .section-title {
            font-size: 2.25rem;
            font-weight: 800;
            color: #1e293b;
        }
        .kpi-card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1);
        }
        .kpi-title {
            color: #64748b;
            font-weight: 500;
        }
        .kpi-value {
            color: #1e3a8a;
            font-weight: 700;
            font-size: 2rem;
        }
        .chart-container {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .input-card {
            perspective: 1000px;
            background-color: transparent;
        }
        .input-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .card-flipped .input-card-inner {
            transform: rotateY(180deg);
        }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            background-color: white;
        }
        .card-back {
            transform: rotateY(180deg);
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #555 transparent transparent transparent;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 50; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto; /* 10% from the top and centered */
            padding: 2rem;
            border: 1px solid #888;
            width: 80%; /* Could be more or less, depending on screen size */
            max-width: 700px;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.2), 0 4px 6px -2px rgb(0 0 0 / 0.1);
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-50">

    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <svg class="h-8 w-auto text-blue-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8.288 15.043A5.242 5.242 0 016.75 15.75a5.242 5.242 0 01-1.538-.707M15.712 15.043A5.242 5.242 0 0117.25 15.75a5.242 5.242 0 011.538-.707M8.288 15.043l3.464-1.999a5.25 5.25 0 005.496 0l3.464 1.999M12 21a8.25 8.25 0 100-16.5 8.25 8.25 0 000 16.5zM12 12V3" />
                </svg>
                <h1 class="text-2xl font-bold text-gray-800">Ohmy<span class="text-blue-600">Fi</span></h1>
            </div>
            <nav class="space-x-4">
                <a href="#simulador" class="text-gray-600 hover:text-blue-600">Simulador</a>
                <a href="#casos-de-exito" class="text-gray-600 hover:text-blue-600">Casos de Éxito</a>
                <a href="#contacto" class="text-gray-600 hover:text-blue-600">Contacto</a>
            </nav>
        </div>
    </header>

    <main class="container mx-auto px-6 py-12">
        <section id="simulador" class="text-center">
            <h2 class="section-title">Descubre el Valor Oculto en tu Conexión WiFi</h2>
            <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">Nuestra herramienta de simulación te ayuda a visualizar el potencial de ingresos y el valor estratégico que OhmyFi puede desbloquear para tu negocio. Ajusta los parámetros para que se adapten a tu realidad y observa el impacto en tiempo real.</p>
        </section>

        <!-- Simulation Input Section -->
        <section class="mt-12">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Input Card 1: APs -->
                <div class="input-card" id="card-aps">
                    <div class="input-card-inner">
                        <div class="card-face p-6 flex flex-col justify-between">
                            <div>
                                <h3 class="text-lg font-bold text-gray-800">Puntos de Acceso (APs)</h3>
                                <p class="text-sm text-gray-500 mt-1">Define la infraestructura WiFi.</p>
                                <div class="mt-4">
                                    <label for="apsIndoor" class="block text-sm font-medium text-gray-700">APs Interiores</label>
                                    <input type="number" id="apsIndoor" value="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                                </div>
                                <div class="mt-4">
                                    <label for="apsOutdoor" class="block text-sm font-medium text-gray-700">APs Exteriores</label>
                                    <input type="number" id="apsOutdoor" value="1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                                </div>
                            </div>
                            <button onclick="flipCard('card-aps')" class="mt-4 text-blue-600 hover:text-blue-800 text-sm font-semibold">Más info</button>
                        </div>
                        <div class="card-back p-6 flex flex-col justify-between">
                            <div>
                                <h4 class="font-bold text-gray-800">¿Qué son los APs?</h4>
                                <p class="text-sm text-gray-600 mt-2">Los Puntos de Acceso son los dispositivos que emiten la señal WiFi. La cantidad y tipo (interior/exterior) determinan el costo inicial (CAPEX) y la cobertura de tu red.</p>
                            </div>
                            <button onclick="flipCard('card-aps')" class="mt-4 text-blue-600 hover:text-blue-800 text-sm font-semibold">Volver</button>
                        </div>
                    </div>
                </div>

                <!-- Input Card 2: Activación -->
                <div class="input-card" id="card-activation">
                    <div class="input-card-inner">
                        <div class="card-face p-6 flex flex-col justify-between">
                            <div>
                                <h3 class="text-lg font-bold text-gray-800">Estrategia de Activación</h3>
                                <p class="text-sm text-gray-500 mt-1">Monetiza tu red y fideliza clientes.</p>
                                <div class="mt-4">
                                    <label for="ltv" class="block text-sm font-medium text-gray-700">Valor Cliente (LTV) ($)</label>
                                    <input type="number" id="ltv" value="35" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                                </div>
                                <div class="mt-4">
                                    <label for="conversionRate" class="block text-sm font-medium text-gray-700">Tasa de Conversión (%)</label>
                                    <input type="number" id="conversionRate" value="5" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                                </div>
                            </div>
                            <button onclick="flipCard('card-activation')" class="mt-4 text-blue-600 hover:text-blue-800 text-sm font-semibold">Más info</button>
                        </div>
                        <div class="card-back p-6 flex flex-col justify-between">
                            <div>
                                <h4 class="font-bold text-gray-800">¿Cómo funciona?</h4>
                                <p class="text-sm text-gray-600 mt-2">El LTV (Lifetime Value) es el ingreso promedio que esperas de un cliente. La Tasa de Conversión es el porcentaje de usuarios WiFi que se convierten en clientes de pago gracias a tus campañas.</p>
                            </div>
                            <button onclick="flipCard('card-activation')" class="mt-4 text-blue-600 hover:text-blue-800 text-sm font-semibold">Volver</button>
                        </div>
                    </div>
                </div>

                <!-- Input Card 3: Tráfico -->
                <div class="input-card" id="card-traffic">
                    <div class="input-card-inner">
                        <div class="card-face p-6 flex flex-col justify-between">
                             <div>
                                <h3 class="text-lg font-bold text-gray-800">Tráfico de Usuarios</h3>
                                <p class="text-sm text-gray-500 mt-1">Estima el volumen de conexiones.</p>
                                <div class="mt-4">
                                    <label for="monthlyUsers" class="block text-sm font-medium text-gray-700">Usuarios Únicos / Mes</label>
                                    <input type="number" id="monthlyUsers" value="1500" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                                </div>
                                <div class="mt-4">
                                    <label for="recurrentPercentage" class="block text-sm font-medium text-gray-700">% Clientes Recurrentes</label>
                                    <input type="number" id="recurrentPercentage" value="20" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                                </div>
                            </div>
                            <button onclick="flipCard('card-traffic')" class="mt-4 text-blue-600 hover:text-blue-800 text-sm font-semibold">Más info</button>
                        </div>
                        <div class="card-back p-6 flex flex-col justify-between">
                            <div>
                                <h4 class="font-bold text-gray-800">¿Por qué es importante?</h4>
                                <p class="text-sm text-gray-600 mt-2">El número de personas que se conectan a tu red es la base para calcular los ingresos potenciales. Diferenciar entre nuevos y recurrentes nos permite entender la lealtad de tus clientes.</p>
                            </div>
                            <button onclick="flipCard('card-traffic')" class="mt-4 text-blue-600 hover:text-blue-800 text-sm font-semibold">Volver</button>
                        </div>
                    </div>
                </div>

                <!-- Input Card 4: Inteligencia de Mercado -->
                <div class="input-card" id="card-market">
                    <div class="input-card-inner">
                        <div class="card-face p-6 flex flex-col justify-between">
                            <div>
                                <h3 class="text-lg font-bold text-gray-800">Inteligencia de Mercado</h3>
                                <p class="text-sm text-gray-500 mt-1">Compara con tus costos actuales.</p>
                                <div class="mt-4">
                                    <label for="cpl" class="block text-sm font-medium text-gray-700">Costo por Lead de Mercado ($)</label>
                                    <input type="number" id="cpl" value="10" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                                </div>
                            </div>
                           <button onclick="flipCard('card-market')" class="mt-4 text-blue-600 hover:text-blue-800 text-sm font-semibold">Más info</button>
                        </div>
                        <div class="card-back p-6 flex flex-col justify-between">
                            <div>
                                <h4 class="font-bold text-gray-800">¿Qué es el CPL?</h4>
                                <p class="text-sm text-gray-600 mt-2">El Costo por Lead (CPL) es lo que pagas actualmente en campañas (Google, Meta, etc.) por cada cliente potencial. OhmyFi te permite generar leads a un costo mucho menor, directamente en tu local.</p>
                            </div>
                            <button onclick="flipCard('card-market')" class="mt-4 text-blue-600 hover:text-blue-800 text-sm font-semibold">Volver</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Financial Dashboard -->
        <section id="financial-results" class="mt-12">
            <!-- LEVEL 1: IMMEDIATE ASSET VALUE -->
            <div id="value-dashboard">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Nivel 1: Valor Inmediato del Activo</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="kpi-card text-center">
                        <div class="flex items-center justify-center space-x-2">
                            <h4 class="kpi-title">Ahorro Anual vs. Publicidad</h4>
                            <div class="tooltip">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg>
                                <span class="tooltiptext">Cuánto dejas de gastar en publicidad tradicional (Google, Meta) al generar tus propios leads con OhmyFi.</span>
                            </div>
                        </div>
                        <p class="kpi-value" id="ad-saving-value">$0</p>
                    </div>
                    <div class="kpi-card text-center">
                         <div class="flex items-center justify-center space-x-2">
                            <h4 class="kpi-title">Clientes Leales Identificados</h4>
                            <div class="tooltip">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg>
                                <span class="tooltiptext">Número de clientes recurrentes que el sistema identifica al mes, permitiéndote crear campañas de fidelización.</span>
                            </div>
                        </div>
                        <p class="kpi-value" id="loyal-customers-value">0</p>
                    </div>
                </div>
            </div>

            <!-- LEVEL 2 & 3: Restored from v36.9 -->
            <div id="financial-dashboard" class="mt-8">
                <!-- LEVEL 2: PROFITABILITY POTENTIAL -->
                <h3 class="text-xl font-bold text-gray-800 mb-4">Nivel 2: Potencial de Rentabilidad (a 3 años)</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="kpi-card text-center">
                        <h4 class="kpi-title">Retorno (ROI) Potencial</h4>
                        <p class="kpi-value" id="roi-value">0%</p>
                    </div>
                    <div class="kpi-card text-center">
                        <h4 class="kpi-title">Beneficio Neto Potencial</h4>
                        <p class="kpi-value" id="net-profit-value">$0</p>
                    </div>
                    <div class="kpi-card text-center">
                        <h4 class="kpi-title">Costo Total (TCO)</h4>
                        <p class="kpi-value" id="tco-value">$0</p>
                    </div>
                    <div class="kpi-card text-center">
                        <h4 class="kpi-title">Recuperación (Payback)</h4>
                        <p class="kpi-value" id="payback-value">N/A</p>
                    </div>
                </div>

                <!-- LEVEL 3: DEEP FINANCIAL ANALYSIS -->
                <div class="mt-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Nivel 3: Análisis Financiero Profundo</h3>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="chart-container">
                            <h5 class="font-bold text-center text-gray-700">Ingresos Potenciales vs. Costos</h5>
                            <canvas id="income-chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h5 class="font-bold text-center text-gray-700">Flujo de Caja Acumulado Potencial</h5>
                            <canvas id="cashflow-chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h5 class="font-bold text-center text-gray-700">Desglose TCO (CAPEX vs OPEX)</h5>
                            <canvas id="tco-composition-chart"></canvas>
                        </div>
                        <div class="chart-container">
                             <h5 class="font-bold text-center text-gray-700">Desglose TCO (por Componente)</h5>
                            <canvas id="tco-breakdown-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Actions Section -->
        <section class="mt-12 text-center">
            <button id="open-glossary" class="bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-lg hover:bg-gray-300 transition">Ver Glosario de Términos</button>
            <button id="generate-pdf" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition ml-4">Generar Reporte PDF</button>
        </section>

        <!-- Glossary Modal -->
        <div id="glossary-modal" class="modal">
            <div class="modal-content">
                <span class="close-button" id="close-glossary">&times;</span>
                <h2 class="text-2xl font-bold mb-4">Glosario de Términos Financieros</h2>
                <dl class="space-y-4">
                    <div>
                        <dt class="font-semibold text-gray-800">Valor Inmediato del Activo</dt>
                        <dd class="text-gray-600 ml-4">Métricas que demuestran el valor que OhmyFi genera desde el primer día, comparado con alternativas de mercado y la identificación de activos de cliente.</dd>
                    </div>
                     <div>
                        <dt class="font-semibold text-gray-800">Ahorro Anual vs. Publicidad</dt>
                        <dd class="text-gray-600 ml-4">El costo estimado que te ahorras en publicidad digital (ej. Google/Meta Ads) al generar la misma cantidad de "leads" (clientes potenciales) a través de tu red WiFi con OhmyFi. Se calcula multiplicando los usuarios nuevos mensuales por el Costo por Lead (CPL) de mercado y luego por 12.</dd>
                    </div>
                    <div>
                        <dt class="font-semibold text-gray-800">Clientes Leales Identificados</dt>
                        <dd class="text-gray-600 ml-4">El número total de clientes que regresan y se conectan a tu red WiFi cada mes. OhmyFi te permite identificar a este valioso segmento para que puedas crear campañas de fidelización y aumentar su valor de por vida (LTV).</dd>
                    </div>
                    <div>
                        <dt class="font-semibold text-gray-800">Retorno de la Inversión (ROI - Return on Investment)</dt>
                        <dd class="text-gray-600 ml-4">Mide la ganancia obtenida en relación con el costo total de la inversión. Un ROI del 150% significa que por cada dólar invertido, has ganado $1.50 adicionales. Se calcula como: (Beneficio Neto / Costo Total) * 100.</dd>
                    </div>
                    <div>
                        <dt class="font-semibold text-gray-800">Beneficio Neto Potencial</dt>
                        <dd class="text-gray-600 ml-4">La ganancia total esperada después de restar todos los costos (hardware, licencias, mantenimiento) de los ingresos generados. Es el dinero "limpio" que queda para el negocio.</dd>
                    </div>
                    <div>
                        <dt class="font-semibold text-gray-800">Costo Total de Propiedad (TCO - Total Cost of Ownership)</dt>
                        <dd class="text-gray-600 ml-4">La suma de todos los costos asociados con la solución OhmyFi durante 3 años. Incluye la inversión inicial en hardware (CAPEX) y los costos operativos recurrentes como licencias y mantenimiento (OPEX).</dd>
                    </div>
                    <div>
                        <dt class="font-semibold text-gray-800">Período de Recuperación (Payback Period)</dt>
                        <dd class="text-gray-600 ml-4">El tiempo que se tarda en recuperar la inversión inicial a través de los ingresos generados. Un payback de 14 meses significa que a partir del mes 15, la inversión está totalmente pagada y todo son ganancias.</dd>
                    </div>
                </dl>
            </div>
        </div>

    </main>

    <footer class="bg-gray-800 text-white mt-16">
        <div class="container mx-auto px-6 py-4 text-center">
            <p>&copy; 2025 AGT - Advanced Growth Technologies. Todos los derechos reservados.</p>
            <p class="text-sm text-gray-400 mt-1">Simulador Financiero OhmyFi - Versión <span id="footer-version">37.5</span></p>
        </div>
    </footer>

    <script>
    // --- CHART & CALCULATION LOGIC ---

    // Global chart instances
    let charts = {};
    const CHART_COLORS = {
        income: 'rgba(59, 130, 246, 0.6)',
        costs: 'rgba(239, 68, 68, 0.6)',
        cashflow: 'rgba(22, 163, 74, 0.6)',
        capex: 'rgba(234, 179, 8, 0.7)',
        opex: 'rgba(249, 115, 22, 0.7)',
        hardware: 'rgba(14, 165, 233, 0.7)',
        license: 'rgba(139, 92, 246, 0.7)',
        maintenance: 'rgba(236, 72, 153, 0.7)'
    };

    // Cost Constants
    const COST_AP_INDOOR = 400;
    const COST_AP_OUTDOOR = 750;
    const COST_LICENSE_PER_AP_PER_YEAR = 120;
    const MAINTENANCE_PERCENTAGE = 0.15; // 15% of hardware cost annually

    function getInputs() {
        return {
            apsIndoor: parseInt(document.getElementById('apsIndoor').value) || 0,
            apsOutdoor: parseInt(document.getElementById('apsOutdoor').value) || 0,
            ltv: parseFloat(document.getElementById('ltv').value) || 0,
            conversionRate: parseFloat(document.getElementById('conversionRate').value) / 100 || 0,
            monthlyUsers: parseInt(document.getElementById('monthlyUsers').value) || 0,
            cpl: parseFloat(document.getElementById('cpl').value) || 0,
            recurrentPercentage: parseFloat(document.getElementById('recurrentPercentage').value) / 100 || 0
        };
    }
    
    function calculate() {
        const d = getInputs();

        // Hardware Cost (CAPEX)
        const capex = (d.apsIndoor * COST_AP_INDOOR) + (d.apsOutdoor * COST_AP_OUTDOOR);
        
        // Annual Operating Costs (OPEX)
        const totalAps = d.apsIndoor + d.apsOutdoor;
        const annualLicenseCost = totalAps * COST_LICENSE_PER_AP_PER_YEAR;
        const annualMaintenanceCost = capex * MAINTENANCE_PERCENTAGE;
        const annualOpex = annualLicenseCost + annualMaintenanceCost;
        
        // Costs over 3 years
        const tco = capex + (annualOpex * 3);

        // Revenue Calculation
        const monthlyNewUsers = d.monthlyUsers * (1 - d.recurrentPercentage);
        const monthlyConversions = monthlyNewUsers * d.conversionRate;
        const monthlyIncome = monthlyConversions * d.ltv;
        const annualIncome = monthlyIncome * 12;

        // Financial Projections (3 years)
        const totalIncome = annualIncome * 3;
        const netProfit = totalIncome - tco;
        const roi = (tco > 0) ? (netProfit / tco) * 100 : 0;
        
        // Payback Period in months
        let paybackMonths = "N/A";
        if (monthlyIncome > (annualOpex / 12)) {
            const netMonthlyCashflow = monthlyIncome - (annualOpex / 12);
            if (netMonthlyCashflow > 0) {
                const monthsToPayback = capex / netMonthlyCashflow;
                 // Add one month for initial investment
                paybackMonths = Math.ceil(monthsToPayback);
            }
        }
        
        // Immediate Value Metrics
        const adSavingAnnual = monthlyNewUsers * d.cpl * 12;
        const loyalCustomersMonthly = d.monthlyUsers * d.recurrentPercentage;

        // Data for charts
        const incomeData = [annualIncome, annualIncome, annualIncome];
        const costData = [capex + annualOpex, annualOpex, annualOpex];
        const cashflowData = [];
        let cumulativeCashflow = 0;
        for (let i = 0; i < 3; i++) {
            cumulativeCashflow += incomeData[i] - costData[i];
            cashflowData.push(cumulativeCashflow);
        }

        return {
            // Level 1
            adSavingAnnual,
            loyalCustomersMonthly,
            // Level 2
            roi,
            netProfit,
            tco,
            paybackMonths,
            // Level 3
            capex,
            totalOpex: annualOpex * 3,
            annualLicenseCost,
            annualMaintenanceCost,
            incomeData,
            costData,
            cashflowData
        };
    }

    function formatCurrency(value) {
        if (typeof value !== 'number' || isNaN(value)) return '$0';
        return `$${value.toLocaleString('en-US', { maximumFractionDigits: 0 })}`;
    }

    function updateDashboard() {
        const data = calculate();
        
        // --- LEVEL 1: UPDATE IMMEDIATE VALUE ---
        document.getElementById('ad-saving-value').textContent = formatCurrency(data.adSavingAnnual);
        document.getElementById('loyal-customers-value').textContent = Math.round(data.loyalCustomersMonthly).toLocaleString('en-US');

        // --- LEVEL 2: UPDATE PROFITABILITY KPIS ---
        document.getElementById('roi-value').textContent = `${data.roi.toFixed(1)}%`;
        document.getElementById('net-profit-value').textContent = formatCurrency(data.netProfit);
        document.getElementById('tco-value').textContent = formatCurrency(data.tco);
        document.getElementById('payback-value').textContent = typeof data.paybackMonths === 'number' ? `${data.paybackMonths} meses` : 'N/A';

        // --- LEVEL 3: UPDATE CHARTS ---
        updateIncomeChart(data.incomeData, data.costData);
        updateCashflowChart(data.cashflowData);
        updateTcoCompositionChart(data.capex, data.totalOpex);
        updateTcoBreakdownChart(data);
    }

    function createOrUpdateChart(id, type, data, options) {
        const ctx = document.getElementById(id).getContext('2d');
        if (charts[id]) {
            charts[id].data = data;
            charts[id].options = options;
            charts[id].update();
        } else {
            charts[id] = new Chart(ctx, { type, data, options });
        }
    }

    const chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { position: 'bottom' }
        },
        scales: {
            y: { beginAtZero: true, ticks: { callback: (value) => formatCurrency(value) } }
        }
    };
    
    function updateIncomeChart(incomeData, costData) {
        const data = {
            labels: ['Año 1', 'Año 2', 'Año 3'],
            datasets: [
                { label: 'Ingresos', data: incomeData, backgroundColor: CHART_COLORS.income },
                { label: 'Costos', data: costData, backgroundColor: CHART_COLORS.costs }
            ]
        };
        createOrUpdateChart('income-chart', 'bar', data, chartOptions);
    }
    
    function updateCashflowChart(cashflowData) {
        const data = {
            labels: ['Fin Año 1', 'Fin Año 2', 'Fin Año 3'],
            datasets: [{
                label: 'Flujo de Caja Acumulado',
                data: cashflowData,
                borderColor: CHART_COLORS.cashflow,
                backgroundColor: CHART_COLORS.cashflow,
                fill: true,
                tension: 0.1
            }]
        };
        const options = { ...chartOptions, scales: { y: { ticks: { callback: (value) => formatCurrency(value) } } } };
        createOrUpdateChart('cashflow-chart', 'line', data, options);
    }

    function updateTcoCompositionChart(capex, totalOpex) {
        const data = {
            labels: ['CAPEX (Inversión Inicial)', 'OPEX (Costos Operativos)'],
            datasets: [{
                data: [capex, totalOpex],
                backgroundColor: [CHART_COLORS.capex, CHART_COLORS.opex]
            }]
        };
        const options = { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } };
        createOrUpdateChart('tco-composition-chart', 'doughnut', data, options);
    }
    
    function updateTcoBreakdownChart(d) {
        const totalAps = (getInputs().apsIndoor || 0) + (getInputs().apsOutdoor || 0);
        const totalLicense = totalAps * COST_LICENSE_PER_AP_PER_YEAR * 3;
        const totalMaintenance = d.capex * MAINTENANCE_PERCENTAGE * 3;

        const data = {
            labels: ['Hardware (APs)', 'Licencias (3 años)', 'Mantenimiento (3 años)'],
            datasets: [{
                data: [d.capex, totalLicense, totalMaintenance],
                backgroundColor: [CHART_COLORS.hardware, CHART_COLORS.license, CHART_COLORS.maintenance]
            }]
        };
        const options = { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } };
        createOrUpdateChart('tco-breakdown-chart', 'pie', data, options);
    }

    // --- UI & EVENT LISTENERS ---

    document.addEventListener('DOMContentLoaded', () => {
        updateDashboard(); // Initial calculation
        
        // Add listeners to all inputs
        const inputs = ['apsIndoor', 'apsOutdoor', 'ltv', 'conversionRate', 'monthlyUsers', 'cpl', 'recurrentPercentage'];
        inputs.forEach(id => {
            document.getElementById(id).addEventListener('input', updateDashboard);
        });

        // Modal listeners
        document.getElementById('open-glossary').addEventListener('click', () => {
            document.getElementById('glossary-modal').style.display = 'block';
        });
        document.getElementById('close-glossary').addEventListener('click', () => {
            document.getElementById('glossary-modal').style.display = 'none';
        });
        window.addEventListener('click', (event) => {
            if (event.target == document.getElementById('glossary-modal')) {
                document.getElementById('glossary-modal').style.display = 'none';
            }
        });

        // PDF Generation
        document.getElementById('generate-pdf').addEventListener('click', generatePdfReport);
    });

    function flipCard(cardId) {
        document.getElementById(cardId).classList.toggle('card-flipped');
    }

    // --- PDF GENERATION LOGIC ---

    async function getPdfChart() {
        // Temporarily resize chart for better PDF quality
        const chartCanvas = document.getElementById('cashflow-chart');
        const container = chartCanvas.parentElement;
        const originalWidth = chartCanvas.style.width;
        const originalHeight = chartCanvas.style.height;
        
        container.style.width = '800px';
        container.style.height = '450px';
        charts['cashflow-chart'].resize();

        await new Promise(resolve => setTimeout(resolve, 500)); // Wait for render
        
        const canvas = await html2canvas(container, { scale: 3 });
        const imgData = canvas.toDataURL('image/png');

        // Restore original size
        container.style.width = null;
        container.style.height = null;
        charts['cashflow-chart'].resize();
        
        return imgData;
    }


    async function generatePdfReport() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const d = calculate();
        const i = getInputs();

        let y = 20;
        const margin = 20;
        const pageWidth = doc.internal.pageSize.getWidth();
        const pageHeight = doc.internal.pageSize.getHeight();
        let page = 1;

        // --- Helper functions ---
        const addFooter = (pageNum) => {
            doc.setFontSize(10);
            doc.setTextColor(150);
            const footerText = `Reporte Confidencial | © AGT 2025 | Página ${pageNum}`;
            const textWidth = doc.getStringUnitWidth(footerText) * doc.internal.getFontSize() / doc.internal.scaleFactor;
            doc.text(footerText, (pageWidth - textWidth) / 2, pageHeight - 10);
        };
        
        const checkPageBreak = (spaceNeeded) => {
            if (y + spaceNeeded > pageHeight - 20) {
                doc.addPage();
                page++;
                y = 20;
                addFooter(page);
            }
        };
        
        const addSectionTitle = (title) => {
            checkPageBreak(20);
            doc.setFontSize(16);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(18, 55, 122);
            doc.text(title, margin, y);
            y += 10;
        };

        const addBodyText = (text, options = {}) => {
            doc.setFontSize(11);
            doc.setFont(undefined, 'normal');
            doc.setTextColor(51, 65, 85);
            const splitText = doc.splitTextToSize(text, pageWidth - margin * 2);
            checkPageBreak(splitText.length * 5 + 5);
            doc.text(splitText, margin, y, options);
            y += splitText.length * 5 + 5;
        };

        // --- PDF Content ---
        addFooter(page);

        // Header
        doc.setFontSize(24);
        doc.setFont(undefined, 'bold');
        doc.setTextColor(30, 64, 175);
        doc.text("Análisis de Oportunidad OhmyFi", margin, y);
        y += 15;

        // Intro
        addSectionTitle("Resumen Ejecutivo");
        const executiveSummary = `Este reporte detalla el potencial de rentabilidad y valor estratégico al implementar la solución OhmyFi con la configuración proporcionada. El análisis proyecta un Retorno de la Inversión (ROI) del ${d.roi.toFixed(1)}% a 3 años, con un beneficio neto de ${formatCurrency(d.netProfit)} y un período de recuperación de la inversión de ${d.paybackMonths} meses.`;
        addBodyText(executiveSummary);

        // Input Parameters
        addSectionTitle("Parámetros de la Simulación");
        const summary = `
        Infraestructura:
          - Puntos de Acceso Interiores: ${i.apsIndoor}
          - Puntos de Acceso Exteriores: ${i.apsOutdoor}
        Estrategia de Activación:
          - Valor de Vida del Cliente (LTV): ${formatCurrency(i.ltv)}
          - Tasa de Conversión: ${(i.conversionRate * 100).toFixed(1)}%
        Tráfico y Mercado:
          - Usuarios Únicos / Mes: ${i.monthlyUsers.toLocaleString('en-US')}
          - Costo por Lead (CPL): ${formatCurrency(i.cpl)}
          - % Clientes Recurrentes: ${(i.recurrentPercentage * 100).toFixed(0)}%
        `;
        const summaryLines = doc.splitTextToSize(summary.trim(), pageWidth - margin * 2);
        checkPageBreak(summaryLines.length * 4);
        doc.text(summary, margin, y);
        y += summaryLines.length * 4;
        
        // --- Adding the High-Fidelity Chart ---\
        addSectionTitle("Proyección de Flujo de Caja Acumulado");
        const chartExplanation = "Este gráfico visualiza el momento en que la inversión se recupera (punto de equilibrio) y comienza a generar ganancias netas. La línea ascendente después de cruzar el cero representa el beneficio neto acumulado a lo largo del tiempo.";
        addBodyText(chartExplanation);
        
        const cashflowChartImg = await getPdfChart();

        const chartWidth = pageWidth - margin * 2;
        const chartHeight = chartWidth * (450 / 800); // Maintain aspect ratio
        checkPageBreak(chartHeight + 10);
        doc.addImage(cashflowChartImg, 'PNG', margin, y, chartWidth, chartHeight);
        y += chartHeight + 10;
        
        addSectionTitle("Análisis y Recomendación del Consultor");
        addBodyText(generateConsultantAnalysis(d));
        
        addSectionTitle("Beneficios Estratégicos");
        const benefits = generateStrategicBenefitsText().replace(/(\d+\.\s)/g, '\n$1').trim();
        addBodyText(benefits);

        addSectionTitle("Próximos Pasos Recomendados");
        addBodyText(generateNextStepsText());

        addFooter(page);
        
        doc.save(`Reporte_Consultoria_AGT_OhmyFi_${new Date().toISOString().slice(0,10)}.pdf`);
    }

    window.generateConsultantAnalysis = (d) => {
        let analysis = `La simulación indica una oportunidad de negocio muy sólida. Un ROI del ${d.roi.toFixed(1)}% es significativamente alto, lo que demuestra que los ingresos generados superan con creces los costos operativos y la inversión inicial. `;

        if (d.paybackMonths < 18 && typeof d.paybackMonths === 'number') {
            analysis += `El período de recuperación de ${d.paybackMonths} meses es particularmente atractivo, ya que posiciona el proyecto como una inversión de bajo riesgo con un retorno rápido. Esto permite que el negocio comience a generar ganancias netas en poco más de un año. `;
        } else {
            analysis += `El período de recuperación de ${d.paybackMonths} meses es razonable para una inversión en infraestructura tecnológica. `;
        }

        analysis += `Además del beneficio financiero directo, el valor estratégico del ahorro en publicidad (${formatCurrency(d.adSavingAnnual)}/año) y la capacidad de identificar a ${Math.round(d.loyalCustomersMonthly)} clientes leales mensualmente no debe subestimarse. Estos factores construyen un activo de datos propio que reduce la dependencia de plataformas de terceros y fortalece la relación con el cliente a largo plazo. \n\nRecomendación: Proceder con un piloto o una implementación por fases para validar estas proyecciones y optimizar la estrategia de conversión.`;
        return analysis;
    };

    window.generateStrategicBenefitsText = () => `
        1. Creación de un Activo de Datos Propio: Reduce la dependencia de plataformas publicitarias (Google, Meta) al capturar datos de primera mano (first-party data) de los clientes que visitan tu ubicación física.
        2. Inteligencia de Negocio Avanzada: Permite entender patrones de comportamiento del cliente, como horas pico de visitas, duración de la estancia y frecuencia de las visitas, optimizando la operativa del negocio.
        3. Canal de Comunicación Directo: Abre una línea directa de marketing para interactuar con los clientes a través de portales cautivos, email o SMS, con ofertas personalizadas que aumentan la conversión.
        4. Mejora de la Experiencia del Cliente: Ofrecer WiFi gratuito y de alta calidad es un servicio valorado que mejora la percepción de la marca y aumenta la satisfacción y el tiempo de permanencia en el local.`;

    window.generateNextStepsText = () => `
        1. Agendar una Sesión de Consultoría: Profundizar en los resultados de esta simulación y adaptarlos con mayor precisión a los objetivos específicos de tu negocio.
        2. Realizar un Estudio de Cobertura (Site Survey): Analizar el plano de tu local para determinar el número y la ubicación óptima de los Puntos de Acceso y garantizar una cobertura perfecta.
        3. Definir la Estrategia de Portal Cautivo: Diseñar la experiencia de usuario en el portal de conexión WiFi para maximizar la captura de datos y las oportunidades de conversión.`;

    </script>
</body>
</html>
