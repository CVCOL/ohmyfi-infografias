<!--
CONTROL DE VERSIONES
=====================
Versión: 8.0 (08/10/2025)
- Corrección de Modelo Financiero: Se ajustó el plazo de financiamiento a un máximo de 3 meses, alineándolo con el modelo de negocio validado en la v6.0.
- Reintegración de Funcionalidad: Se recuperó el generador de informes en PDF, incluyendo el botón, la modal de previsualización y la lógica de descarga.
- Mejora de Interactividad y Usabilidad: Se extendió el efecto de giro 3D (activado por clic) a las tarjetas de la sección "El Viaje del Dato". Se añadió un botón "Volver" en la cara posterior de todas las tarjetas interactivas para una navegación más intuitiva.

Versión: 7.0 (08/10/2025)
- Evolución a Herramienta de Ventas (Mobile-First): Rediseño integral enfocado en la experiencia móvil, con nueva narrativa visual ("El Viaje del Dato") y contenedores interactivos 3D.

Versión: 6.0 (07/10/2025)
- Rediseño gráfico integral: Implementación de la paleta de colores corporativa de AGT, nueva iconografía profesional y tarjetas de análisis interactivas.
-->
<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análisis Interactivo de Valor: OhmyFi + Zoho en Venezuela</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --agt-dark: #0F172A; /* Slate 900 */
            --agt-blue: #1E3A8A; /* Indigo 800 */
            --agt-orange: #F97316; /* Orange 500 */
            --agt-light-gray: #F1F5F9; /* Slate 100 */
            --agt-text: #E2E8F0; /* Slate 200 */
        }
        body { 
            font-family: 'Inter', sans-serif;
            background-color: var(--agt-dark);
            color: var(--agt-text);
        }
        .section-title {
            font-size: 2.25rem;
            font-weight: 800;
            line-height: 1.2;
            text-align: center;
            margin-bottom: 1rem;
        }
        .section-subtitle {
            font-size: 1.125rem;
            text-align: center;
            color: #94a3b8; /* Slate 400 */
            max-width: 800px;
            margin: 0 auto 3rem auto;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .btn-primary {
            background-color: var(--agt-orange);
            color: white;
        }
        .btn-primary:hover {
            background-color: #FB923C; /* Orange 400 */
        }
        .btn-secondary {
            background-color: #334155; /* Slate 700 */
            color: var(--agt-text);
        }
        .btn-secondary:hover {
             background-color: #475569; /* Slate 600 */
        }
        .btn-active {
            background-color: var(--agt-orange);
            color: white;
            box-shadow: 0 0 15px rgba(249, 115, 22, 0.5);
        }
        .card {
            background-color: #1E293B; /* Slate 800 */
            border-radius: 0.75rem;
            padding: 1.5rem;
            border: 1px solid #334155; /* Slate 700 */
        }

        /* 3D Flip Card Styles */
        .flip-card {
            background-color: transparent;
            width: 100%;
            min-height: 200px; /* Altura mínima para tarjetas de viaje del dato */
            perspective: 1000px;
        }
        .chart-flip-card {
            height: 450px;
        }
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }
        .flip-card.is-flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden; /* Safari */
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #1E293B; /* Slate 800 */
            border-radius: 0.75rem;
            border: 1px solid #334155; /* Slate 700 */
            padding: 1.5rem;
        }
        .flip-card-back {
            transform: rotateY(180deg);
        }
        .flip-trigger {
            position: absolute;
            top: 15px;
            right: 15px;
            cursor: pointer;
            z-index: 10;
            color: #94a3b8;
            transition: color 0.3s;
        }
        .flip-trigger:hover {
            color: var(--agt-orange);
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">

        <!-- HEADER -->
        <header class="mb-16 text-center">
            <img src="https://placehold.co/1080x720/0F172A/F97316?text=Equipo+Profesional+Analizando+Datos" 
                 alt="Equipo de profesionales analizando datos en un entorno tecnológico"
                 class="w-full h-64 md:h-96 object-cover rounded-xl mb-8 opacity-75">
            <h1 class="text-4xl md:text-6xl font-extrabold mb-4 leading-tight">
                Transforme su Wi-Fi de un <span class="text-red-400">Gasto</span> a un <span class="text-green-400">Activo Estratégico</span>
            </h1>
            <p class="section-subtitle">Descubra cómo la solución OhmyFi + Zoho CRM, implementada por AGT, convierte su red de invitados en un motor de inteligencia de negocios y crecimiento para el mercado venezolano.</p>
        </header>

        <!-- DATA JOURNEY SECTION -->
        <section class="mb-20">
            <h2 class="section-title">El Viaje del Dato: De Conexión a Conversión</h2>
            <p class="section-subtitle">Visualice el flujo de valor. Así es como convertimos una simple conexión Wi-Fi en una relación rentable y medible con sus clientes.</p>
            <div class="grid grid-cols-1 md:grid-cols-5 gap-6 relative">
                
                <!-- Card 1 -->
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                             <i data-lucide="info" class="flip-trigger"></i>
                             <i data-lucide="wifi" class="w-12 h-12 mb-4 text-orange-500"></i>
                             <h3 class="font-bold text-lg mb-2">1. Conexión</h3>
                             <p class="text-sm text-slate-400">El cliente se conecta al Wi-Fi gratuito a través de un portal cautivo personalizado.</p>
                        </div>
                        <div class="flip-card-back">
                             <h3 class="font-bold text-lg mb-2 text-orange-400">Portal de Marca</h3>
                             <p class="text-sm text-slate-300 mb-4">El primer contacto es clave. Creamos un portal de acceso con su identidad de marca que ofrece una experiencia de conexión segura y profesional, cumpliendo con la ley y generando confianza desde el inicio.</p>
                             <button class="btn btn-secondary flip-back-trigger"><i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>Volver</button>
                        </div>
                    </div>
                </div>

                <!-- Card 2 -->
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <i data-lucide="info" class="flip-trigger"></i>
                            <i data-lucide="database" class="w-12 h-12 mb-4 text-orange-500"></i>
                            <h3 class="font-bold text-lg mb-2">2. Captura</h3>
                            <p class="text-sm text-slate-400">Se capturan datos de primera mano (First-Party Data) con consentimiento explícito.</p>
                        </div>
                        <div class="flip-card-back">
                            <h3 class="font-bold text-lg mb-2 text-orange-400">Activo de Datos</h3>
                            <p class="text-sm text-slate-300 mb-4">Los "First-Party Data" son su activo más valioso. A diferencia de los datos de terceros, son precisos, relevantes y obtenidos con consentimiento, formando la base para una personalización efectiva y legal.</p>
                            <button class="btn btn-secondary flip-back-trigger"><i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>Volver</button>
                        </div>
                    </div>
                </div>

                <!-- Card 3 -->
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <i data-lucide="info" class="flip-trigger"></i>
                            <i data-lucide="users" class="w-12 h-12 mb-4 text-orange-500"></i>
                            <h3 class="font-bold text-lg mb-2">3. Perfilamiento</h3>
                            <p class="text-sm text-slate-400">El perfil del cliente se crea o actualiza automáticamente en Zoho CRM.</p>
                        </div>
                         <div class="flip-card-back">
                            <h3 class="font-bold text-lg mb-2 text-orange-400">Inteligencia 360°</h3>
                            <p class="text-sm text-slate-300 mb-4">La integración nativa con Zoho CRM es nuestro gran diferenciador. Cada conexión enriquece el perfil del cliente, unificando su comportamiento online y offline para una visión completa.</p>
                            <button class="btn btn-secondary flip-back-trigger"><i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>Volver</button>
                        </div>
                    </div>
                </div>

                <!-- Card 4 -->
                 <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <i data-lucide="info" class="flip-trigger"></i>
                            <i data-lucide="send" class="w-12 h-12 mb-4 text-orange-500"></i>
                            <h3 class="font-bold text-lg mb-2">4. Activación</h3>
                            <p class="text-sm text-slate-400">Se disparan campañas de marketing automatizadas y personalizadas.</p>
                        </div>
                        <div class="flip-card-back">
                           <h3 class="font-bold text-lg mb-2 text-orange-400">Marketing de Precisión</h3>
                           <p class="text-sm text-slate-300 mb-4">La automatización permite impactar al cliente correcto en el momento oportuno. Ej: un cupón de "te extrañamos" si no vuelve en 30 días, o una oferta de cumpleaños. Marketing que convierte.</p>
                           <button class="btn btn-secondary flip-back-trigger"><i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>Volver</button>
                        </div>
                    </div>
                </div>

                <!-- Card 5 -->
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <i data-lucide="info" class="flip-trigger"></i>
                            <i data-lucide="bar-chart-2" class="w-12 h-12 mb-4 text-orange-500"></i>
                            <h3 class="font-bold text-lg mb-2">5. Medición</h3>
                            <p class="text-sm text-slate-400">Se mide el ROI, LTV y el impacto real de cada interacción en las ventas.</p>
                        </div>
                        <div class="flip-card-back">
                            <h3 class="font-bold text-lg mb-2 text-orange-400">Cierre del Ciclo</h3>
                            <p class="text-sm text-slate-300 mb-4">La solución permite atribuir ventas e ingresos directamente a las campañas de WiFi Marketing, demostrando el valor tangible y el ROI. Dejamos de adivinar y empezamos a medir el impacto real.</p>
                            <button class="btn btn-secondary flip-back-trigger"><i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>Volver</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SIMULATOR SECTION -->
        <section id="simulator" class="mb-20">
             <div class="flex flex-col md:flex-row justify-between items-center mb-8">
                <div class="text-center md:text-left mb-6 md:mb-0">
                    <h2 class="section-title !text-left !mb-0">Simulador Financiero Interactivo</h2>
                    <p class="section-subtitle !text-left !ml-0 max-w-2xl">Ajuste las variables y proyecte el impacto financiero real. Compare dos escenarios clave para el mercado venezolano.</p>
                </div>
                <button id="generate-report-btn" class="btn btn-primary"><i data-lucide="download" class="w-5 h-5 mr-2"></i>Generar Informe PDF</button>
            </div>
            
            <div class="text-center mb-8">
                <button id="btn-completa" class="btn btn-active mr-4">Escenario 1: Solución Completa (AGT)</button>
                <button id="btn-byod" class="btn btn-secondary">Escenario 2: Infraestructura Propia (BYOD)</button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Columna de Inputs -->
                <div class="lg:col-span-1 space-y-6">
                    <div id="image-container" class="mb-6">
                        <img id="scenario-image" src="https://placehold.co/1080x720/1E293B/94A3B8?text=Instalación+Profesional+de+Wi-Fi" 
                             alt="Técnico instalando un punto de acceso Wi-Fi"
                             class="w-full h-auto object-cover rounded-lg transition-opacity duration-500">
                    </div>
                    
                    <div class="card">
                        <h3 class="text-xl font-bold mb-4 text-orange-400 flex items-center"><i data-lucide="dollar-sign" class="w-6 h-6 mr-2"></i>Inversión Inicial (CAPEX)</h3>
                        <label class="block mb-2 text-sm font-medium">Costo Hardware Base (USD)</label>
                        <input type="number" id="base-hardware-cost" value="2500" class="w-full p-2 rounded bg-slate-700 border border-slate-600 focus:ring-orange-500 focus:border-orange-500">
                    </div>

                    <div class="card">
                        <h3 class="text-xl font-bold mb-4 text-orange-400 flex items-center"><i data-lucide="sliders-horizontal" class="w-6 h-6 mr-2"></i>Costos Operativos (OPEX)</h3>
                        <label class="block mb-2 text-sm font-medium">Licencia Anual OhmyFi (USD)</label>
                        <input type="number" id="annual-license-cost" value="1200" class="w-full p-2 rounded bg-slate-700 border border-slate-600 focus:ring-orange-500 focus:border-orange-500">
                        <label class="block mt-4 mb-2 text-sm font-medium">Soporte y Mantenimiento Anual (USD)</label>
                        <input type="number" id="annual-support-cost" value="600" class="w-full p-2 rounded bg-slate-700 border border-slate-600 focus:ring-orange-500 focus:border-orange-500">
                    </div>

                    <div class="card">
                        <h3 class="text-xl font-bold mb-4 text-orange-400 flex items-center"><i data-lucide="trending-up" class="w-6 h-6 mr-2"></i>Generación de Ingresos</h3>
                        <label class="block mb-2 text-sm font-medium">Nuevos Clientes/Mes (vía WiFi)</label>
                        <input type="number" id="new-customers-monthly" value="50" class="w-full p-2 rounded bg-slate-700 border border-slate-600 focus:ring-orange-500 focus:border-orange-500">
                        <label class="block mt-4 mb-2 text-sm font-medium">Valor de Vida del Cliente (LTV - USD)</label>
                        <input type="number" id="customer-lifetime-value" value="150" class="w-full p-2 rounded bg-slate-700 border border-slate-600 focus:ring-orange-500 focus:border-orange-500">
                    </div>

                     <div id="financing-section" class="card">
                        <h3 class="text-xl font-bold mb-4 text-orange-400 flex items-center"><i data-lucide="banknote" class="w-6 h-6 mr-2"></i>Financiamiento (Sol. Completa)</h3>
                        <label for="financing-term" class="block mb-2 text-sm font-medium">Plazo de Financiamiento: <span id="financing-term-value" class="font-bold text-orange-400">0</span> meses</label>
                        <input type="range" id="financing-term" min="0" max="3" value="0" step="1" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                    </div>
                </div>

                <!-- Columna de Dashboard -->
                <div class="lg:col-span-2">
                    <div id="dashboard" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        
                        <div class="md:col-span-2 card text-center">
                            <h3 class="text-lg font-semibold text-slate-400">Retorno de la Inversión (ROI) a 3 Años</h3>
                            <p id="roi-value" class="text-5xl font-extrabold text-green-400 my-2">0%</p>
                            <p id="roi-text" class="text-sm text-slate-400">...</p>
                        </div>

                        <div class="card text-center">
                             <h3 class="text-lg font-semibold text-slate-400">Costo Total de Propiedad (TCO) a 3 Años</h3>
                            <p id="tco-value" class="text-4xl font-bold text-red-400 my-2">$0</p>
                            <p id="tco-text" class="text-sm text-slate-400">...</p>
                        </div>
                        
                        <div class="card text-center">
                            <h3 class="text-lg font-semibold text-slate-400">Período de Recuperación (Payback)</h3>
                            <p id="payback-value" class="text-4xl font-bold text-blue-400 my-2">0 Meses</p>
                            <p id="payback-text" class="text-sm text-slate-400">...</p>
                        </div>
                        
                        <!-- ROI Components Chart -->
                        <div class="flip-card chart-flip-card">
                            <div class="flip-card-inner">
                                <div class="flip-card-front">
                                    <i data-lucide="info" class="flip-trigger"></i>
                                    <h3 class="font-bold mb-2">Componentes del ROI</h3>
                                    <canvas id="roiComponentsChart"></canvas>
                                </div>
                                <div class="flip-card-back">
                                    <h3 class="font-bold text-xl mb-4 text-orange-400">¿Qué Muestra este Gráfico?</h3>
                                    <p class="text-base text-slate-300 mb-6">Este gráfico desglosa el Retorno de la Inversión (ROI). Compara el **Beneficio Neto Total** (ingresos generados gracias a la solución) contra el **Costo Total de Propiedad (TCO)**. Un beneficio significativamente mayor que el costo resulta en un ROI positivo y una inversión rentable.</p>
                                    <button class="btn btn-secondary flip-back-trigger"><i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>Volver al Gráfico</button>
                                </div>
                            </div>
                        </div>

                        <!-- TCO Breakdown Chart -->
                        <div class="flip-card chart-flip-card">
                            <div class="flip-card-inner">
                                <div class="flip-card-front">
                                     <i data-lucide="info" class="flip-trigger"></i>
                                    <h3 class="font-bold mb-2">Desglose del TCO</h3>
                                    <canvas id="tcoBreakdownChart"></canvas>
                                </div>
                                <div class="flip-card-back">
                                    <h3 class="font-bold text-xl mb-4 text-orange-400">Entendiendo el TCO</h3>
                                    <p class="text-base text-slate-300 mb-6">El Costo Total de Propiedad (TCO) no es solo el precio inicial. Este gráfico muestra cómo se distribuye su inversión a lo largo de 3 años, incluyendo el **hardware inicial (CAPEX)** y los **costos operativos recurrentes (OPEX)** como licencias y soporte. Entender esto es clave para una planificación financiera precisa.</p>
                                    <button class="btn btn-secondary flip-back-trigger"><i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>Volver al Gráfico</button>
                                </div>
                            </div>
                        </div>

                        <!-- Payback Chart -->
                        <div class="flip-card chart-flip-card md:col-span-2">
                            <div class="flip-card-inner">
                                <div class="flip-card-front">
                                     <i data-lucide="info" class="flip-trigger"></i>
                                    <h3 class="font-bold mb-2">Camino a la Rentabilidad</h3>
                                    <canvas id="paybackChart"></canvas>
                                </div>
                                <div class="flip-card-back">
                                    <h3 class="font-bold text-xl mb-4 text-orange-400">El Punto de Equilibrio</h3>
                                    <p class="text-base text-slate-300 mb-6">Este gráfico ilustra el "Período de Recuperación". Muestra la **inversión acumulada** (costos) y cómo los **ingresos acumulados** la superan con el tiempo. El punto donde la línea de ingresos cruza la de costos es su punto de equilibrio: el momento exacto en que la solución se ha pagado a sí misma y comienza a generar ganancias netas.</p>
                                    <button class="btn btn-secondary flip-back-trigger"><i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>Volver al Gráfico</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SIGNIFICADOS SECTION -->
        <section class="mb-16">
            <h2 class="section-title">Glosario Financiero</h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                 <div class="card">
                    <h3 class="font-bold text-lg text-orange-400 mb-2">Retorno de la Inversión (ROI)</h3>
                    <p class="text-sm text-slate-300">Mide la ganancia o pérdida generada en relación con el monto invertido. Un ROI alto indica alta rentabilidad.</p>
                </div>
                 <div class="card">
                    <h3 class="font-bold text-lg text-orange-400 mb-2">Costo Total de Propiedad (TCO)</h3>
                    <p class="text-sm text-slate-300">Cálculo completo de todos los costos asociados con la solución a lo largo de su vida útil (3 años en esta simulación).</p>
                </div>
                <div class="card">
                    <h3 class="font-bold text-lg text-orange-400 mb-2">Período de Recuperación (Payback)</h3>
                    <p class="text-sm text-slate-300">El tiempo necesario para que los ingresos generados por la solución igualen la inversión inicial. Un payback corto es ideal.</p>
                </div>
                <div class="card">
                    <h3 class="font-bold text-lg text-orange-400 mb-2">Valor de Vida del Cliente (LTV)</h3>
                    <p class="text-sm text-slate-300">La ganancia neta total que una empresa espera obtener de un cliente durante toda su relación comercial.</p>
                </div>
                 <div class="card">
                    <h3 class="font-bold text-lg text-orange-400 mb-2">CAPEX (Capital Expenditures)</h3>
                    <p class="text-sm text-slate-300">Gastos en activos fijos, como el hardware. Es una inversión inicial, no un gasto recurrente.</p>
                </div>
                <div class="card">
                    <h3 class="font-bold text-lg text-orange-400 mb-2">OPEX (Operational Expenditures)</h3>
                    <p class="text-sm text-slate-300">Gastos operativos continuos necesarios para el funcionamiento del negocio, como licencias y soporte.</p>
                </div>
            </div>
        </section>
        
        <footer class="text-center py-8 border-t border-slate-700">
            <p class="text-slate-400">Simulador Financiero v8.0 | Desarrollado por Gemini para AGT Comunidades</p>
        </footer>

    </div>

    <!-- PDF Report Modal -->
    <div id="report-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 transition-opacity duration-300 opacity-0 pointer-events-none">
        <div class="bg-slate-800 rounded-lg shadow-xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-orange-400">Resumen Ejecutivo de la Simulación</h2>
                <button id="report-close-btn" class="text-slate-400 hover:text-white">&times;</button>
            </div>
            <div class="bg-slate-900 p-4 rounded-md mb-6">
                <pre id="report-content" class="text-sm text-slate-300 whitespace-pre-wrap font-mono"></pre>
            </div>
            <div class="text-right">
                <button id="report-download-btn" class="btn btn-primary"><i data-lucide="download" class="w-5 h-5 mr-2"></i>Descargar PDF</button>
            </div>
        </div>
    </div>

<script>
    const ui = {
        buttons: {
            completa: document.getElementById('btn-completa'),
            byod: document.getElementById('btn-byod'),
        },
        inputs: {
            baseHardware: document.getElementById('base-hardware-cost'),
            annualLicense: document.getElementById('annual-license-cost'),
            annualSupport: document.getElementById('annual-support-cost'),
            newCustomers: document.getElementById('new-customers-monthly'),
            customerLTV: document.getElementById('customer-lifetime-value'),
        },
        financing: {
            section: document.getElementById('financing-section'),
            slider: document.getElementById('financing-term'),
            valueLabel: document.getElementById('financing-term-value'),
        },
        outputs: {
            roi: { value: document.getElementById('roi-value'), text: document.getElementById('roi-text') },
            tco: { value: document.getElementById('tco-value'), text: document.getElementById('tco-text') },
            payback: { value: document.getElementById('payback-value'), text: document.getElementById('payback-text') },
        },
        scenario: {
            image: document.getElementById('scenario-image'),
        },
        report: {
            modal: document.getElementById('report-modal'),
            generateBtn: document.getElementById('generate-report-btn'),
            closeBtn: document.getElementById('report-close-btn'),
            downloadBtn: document.getElementById('report-download-btn'),
            content: document.getElementById('report-content'),
        }
    };

    const config = {
        completa: {
            auxComponents: 1250,
            configFee: 800,
            physicalInstall: 500,
            financingInterest: 0.15,
            image: 'https://placehold.co/1080x720/1E293B/94A3B8?text=Instalación+Profesional+de+Wi-Fi',
            alt: 'Técnico instalando un punto de acceso Wi-Fi'
        },
        byod: {
            configFee: 1000,
            physicalInstall: 0,
            image: 'https://placehold.co/1080x720/1E293B/94A3B8?text=Gestión+de+Infraestructura+Propia',
            alt: 'Persona de TI gestionando su propia infraestructura de red'
        }
    };

    let currentScenario = 'completa';
    let charts = {};
    let lastCalculationData = {};

    function initialize() {
        setupEventListeners();
        createCharts();
        calculate();
        lucide.createIcons();
    }

    function setupEventListeners() {
        ui.buttons.completa.addEventListener('click', () => setScenario('completa'));
        ui.buttons.byod.addEventListener('click', () => setScenario('byod'));
        
        Object.values(ui.inputs).forEach(input => input.addEventListener('input', calculate));
        ui.financing.slider.addEventListener('input', () => {
            ui.financing.valueLabel.textContent = ui.financing.slider.value;
            calculate();
        });

        document.querySelectorAll('.flip-card').forEach(card => {
            const trigger = card.querySelector('.flip-trigger');
            const backTrigger = card.querySelector('.flip-back-trigger');
            if(trigger) {
                trigger.addEventListener('click', (e) => {
                    e.stopPropagation();
                    card.classList.add('is-flipped');
                });
            }
             if(backTrigger) {
                backTrigger.addEventListener('click', (e) => {
                    e.stopPropagation();
                    card.classList.remove('is-flipped');
                });
            }
        });
        
        // Report Listeners
        ui.report.generateBtn.addEventListener('click', () => {
            ui.report.content.textContent = generateReportText(lastCalculationData);
            ui.report.modal.classList.remove('opacity-0', 'pointer-events-none');
        });
        ui.report.closeBtn.addEventListener('click', () => ui.report.modal.classList.add('opacity-0', 'pointer-events-none'));
        ui.report.downloadBtn.addEventListener('click', () => downloadPDF(lastCalculationData));
    }

    function setScenario(scenario) {
        currentScenario = scenario;
        ui.buttons.completa.classList.toggle('btn-active', scenario === 'completa');
        ui.buttons.completa.classList.toggle('btn-secondary', scenario !== 'completa');
        ui.buttons.byod.classList.toggle('btn-active', scenario === 'byod');
        ui.buttons.byod.classList.toggle('btn-secondary', scenario !== 'byod');

        ui.financing.section.style.display = scenario === 'completa' ? 'block' : 'none';
        
        ui.scenario.image.style.opacity = 0;
        setTimeout(() => {
            ui.scenario.image.src = config[scenario].image;
            ui.scenario.image.alt = config[scenario].alt;
            ui.scenario.image.style.opacity = 1;
        }, 500);

        calculate();
    }

    function calculate() {
        const values = {
            baseHardware: parseFloat(ui.inputs.baseHardware.value) || 0,
            annualLicense: parseFloat(ui.inputs.annualLicense.value) || 0,
            annualSupport: parseFloat(ui.inputs.annualSupport.value) || 0,
            newCustomers: parseFloat(ui.inputs.newCustomers.value) || 0,
            customerLTV: parseFloat(ui.inputs.customerLTV.value) || 0,
            financingTerm: parseInt(ui.financing.slider.value, 10) || 0,
        };

        let capex, tco, totalRevenue, netBenefit, roi, paybackPeriod;
        let totalOpex, financingCost = 0;
        
        if (currentScenario === 'completa') {
            const initialInvestment = values.baseHardware + config.completa.auxComponents + config.completa.configFee + config.completa.physicalInstall;
            if (values.financingTerm > 0) {
                financingCost = initialInvestment * config.completa.financingInterest * (values.financingTerm / 12);
            }
            capex = initialInvestment;
            totalOpex = (values.annualLicense + values.annualSupport) * 3;
            tco = capex + totalOpex + financingCost;
        } else { // byod
            capex = values.baseHardware + config.byod.configFee;
            totalOpex = (values.annualLicense + values.annualSupport) * 3;
            tco = capex + totalOpex;
        }

        totalRevenue = values.newCustomers * 12 * 3 * values.customerLTV;
        netBenefit = totalRevenue - tco;
        roi = tco > 0 ? (netBenefit / tco) * 100 : 0;
        
        const monthlyRevenue = values.newCustomers * values.customerLTV;
        const monthlyOpex = (values.annualLicense + values.annualSupport) / 12;
        let cumulativeNet = -capex;
        paybackPeriod = -1;
        const monthlyData = [];

        for (let month = 1; month <= 36; month++) {
            cumulativeNet += monthlyRevenue - monthlyOpex;
            if (cumulativeNet > 0 && paybackPeriod === -1) {
                paybackPeriod = month;
            }
            monthlyData.push({
                month: month,
                revenue: monthlyRevenue * month,
                cost: capex + (monthlyOpex * month),
            });
        }

        lastCalculationData = { ...values, capex, tco, totalRevenue, netBenefit, roi, paybackPeriod, totalOpex, financingCost, scenario: currentScenario };
        updateUI(roi, tco, paybackPeriod, netBenefit, capex, totalOpex, monthlyData);
    }
    
    function updateUI(roi, tco, paybackPeriod, netBenefit, capex, totalOpex, monthlyData) {
        ui.outputs.roi.value.textContent = `${roi.toFixed(0)}%`;
        ui.outputs.tco.value.textContent = `$${tco.toLocaleString('en-US', {maximumFractionDigits:0})}`;
        ui.outputs.payback.value.textContent = paybackPeriod > 0 ? `${paybackPeriod} Meses` : "N/A";

        ui.outputs.roi.text.textContent = `Genera un beneficio neto de $${netBenefit.toLocaleString('en-US', {maximumFractionDigits:0})} sobre el costo total.`;
        ui.outputs.tco.text.textContent = `Costo total distribuido en 3 años.`;
        ui.outputs.payback.text.textContent = paybackPeriod > 0 ? `La inversión se recupera y empieza a generar ganancias en el mes ${paybackPeriod}.` : 'Los ingresos no cubren la inversión en 3 años.';
        
        updateCharts(netBenefit, tco, capex, totalOpex, monthlyData);
    }

    function createCharts() {
        const chartOptions = {
            responsive: true, maintainAspectRatio: false,
            plugins: { legend: { labels: { color: 'white' } } },
            scales: {
                x: { ticks: { color: 'white' }, grid: { color: '#334155' } },
                y: { ticks: { color: 'white' }, grid: { color: '#334155' } }
            }
        };

        charts.roiComponents = new Chart(document.getElementById('roiComponentsChart').getContext('2d'), { type: 'bar', data: { labels: ['Análisis de Rentabilidad'], datasets: [{ label: 'Beneficio Neto', data: [], backgroundColor: '#22C55E' }, { label: 'Costo Total (TCO)', data: [], backgroundColor: '#EF4444' }] }, options: chartOptions });
        charts.tcoBreakdown = new Chart(document.getElementById('tcoBreakdownChart').getContext('2d'), { type: 'doughnut', data: { labels: ['Inversión Inicial (CAPEX)', 'Costos Operativos (OPEX)'], datasets: [{ data: [], backgroundColor: ['#3B82F6', '#F97316'] }] }, options: { ...chartOptions, scales: {} } });
        charts.payback = new Chart(document.getElementById('paybackChart').getContext('2d'), { type: 'line', data: { labels: Array.from({ length: 36 }, (_, i) => i + 1), datasets: [{ label: 'Ingresos Acumulados', data: [], borderColor: '#22C55E', tension: 0.1, fill: false }, { label: 'Costos Acumulados', data: [], borderColor: '#EF4444', tension: 0.1, fill: false }] }, options: { ...chartOptions, scales: { ...chartOptions.scales, x: { ...chartOptions.scales.x, title: { display: true, text: 'Meses', color:'white' } } } } });
    }

    function updateCharts(netBenefit, tco, capex, totalOpex, monthlyData) {
        charts.roiComponents.data.datasets[0].data = [netBenefit];
        charts.roiComponents.data.datasets[1].data = [tco];
        charts.roiComponents.update();
        charts.tcoBreakdown.data.datasets[0].data = [capex, totalOpex];
        charts.tcoBreakdown.update();
        charts.payback.data.datasets[0].data = monthlyData.map(d => d.revenue);
        charts.payback.data.datasets[1].data = monthlyData.map(d => d.cost);
        charts.payback.update();
    }
    
    function generateReportText(d) {
        const scenarioText = d.scenario === 'completa' ? 'Solución Completa (AGT)' : 'Infraestructura Propia (BYOD)';
        return `
INFORME DE ANÁLISIS FINANCIERO - SOLUCIÓN AGT OHMYFI
=====================================================
Fecha: ${new Date().toLocaleDateString('es-VE')}
Escenario Simulado: ${scenarioText}

PARÁMETROS DE ENTRADA:
----------------------
- Costo Hardware Base: $${d.baseHardware.toLocaleString()}
- Licencia Anual OhmyFi: $${d.annualLicense.toLocaleString()}
- Soporte y Mantenimiento Anual: $${d.annualSupport.toLocaleString()}
- Nuevos Clientes/Mes: ${d.newCustomers}
- Valor de Vida del Cliente (LTV): $${d.customerLTV.toLocaleString()}
${d.scenario === 'completa' ? `- Plazo de Financiamiento: ${d.financingTerm} meses` : ''}

RESULTADOS PROYECTADOS A 3 AÑOS:
--------------------------------
- INVERSIÓN INICIAL (CAPEX): $${d.capex.toLocaleString()}
- COSTOS OPERATIVOS TOTALES (OPEX): $${d.totalOpex.toLocaleString()}
${d.financingCost > 0 ? `- COSTO DE FINANCIAMIENTO: $${d.financingCost.toLocaleString(undefined, {maximumFractionDigits:0})}` : ''}

- COSTO TOTAL DE PROPIEDAD (TCO): $${d.tco.toLocaleString(undefined, {maximumFractionDigits:0})}
- INGRESOS TOTALES GENERADOS: $${d.totalRevenue.toLocaleString()}
- BENEFICIO NETO: $${d.netBenefit.toLocaleString(undefined, {maximumFractionDigits:0})}

INDICADORES CLAVE DE RENDIMIENTO (KPI):
---------------------------------------
- RETORNO DE LA INVERSIÓN (ROI): ${d.roi.toFixed(0)}%
- PERÍODO DE RECUPERACIÓN (PAYBACK): ${d.paybackPeriod > 0 ? `${d.paybackPeriod} meses` : 'No se recupera en 36 meses'}

CONCLUSIÓN:
-----------
Bajo los parámetros especificados, la implementación de la solución representa una inversión ${d.roi > 0 ? 'altamente rentable' : 'que requiere revisión'}. El capital invertido se recuperaría en ${d.paybackPeriod > 0 ? `${d.paybackPeriod} meses` : 'más de 3 años'}, y generaría un retorno del ${d.roi.toFixed(0)}% sobre el costo total en un período de 3 años.
`;
    }

    function downloadPDF(d) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const reportText = generateReportText(d);
        
        doc.setFont('courier', 'normal');
        doc.setFontSize(10);
        doc.text(reportText, 10, 10);
        doc.save(`Reporte_OhmyFi_${d.scenario}_${new Date().toISOString().slice(0,10)}.pdf`);
    }

    window.onload = initialize;
</script>
</body>
</html>
