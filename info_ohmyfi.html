<!--
CONTROL DE VERSIONES
=====================
Versión: 11.0 (08/10/2025)
- Versión Definitiva y Estable: Se reemplazó por completo el motor de cálculo por el de la v6.0, garantizando resultados idénticos. Se rediseñó el panel de entrada de datos en una tarjeta unificada y organizada para una UX superior. Se reincorporaron los gráficos "Evolución de Costos Mensuales" y "Camino a la Rentabilidad". Se implementó la lógica de textos de análisis dinámicos de la v6.0 para ROI y Payback.

Versión: 10.0 (08/10/2025)
- Fusión v6+v9: Se corrigió el layout de inputs y se reincorporaron los gráficos de Monte Carlo y Crossover.

Versión: 9.0 (08/10/2025)
- Restauración del Motor de Cálculo v6.0 y Mejora de Interactividad (Hover vs. Clic).
-->
<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análisis Interactivo de Valor: OhmyFi + Zoho en Venezuela</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --agt-dark: #0F172A; /* Slate 900 */
            --agt-blue: #1E3A8A; /* Indigo 800 */
            --agt-orange: #F97316; /* Orange 500 */
            --agt-light-gray: #F1F5F9; /* Slate 100 */
            --agt-text: #E2E8F0; /* Slate 200 */
        }
        body { 
            font-family: 'Inter', sans-serif;
            background-color: var(--agt-dark);
            color: var(--agt-text);
        }
        .section-title {
            font-size: 2.25rem;
            font-weight: 800;
            line-height: 1.2;
            text-align: center;
            margin-bottom: 1rem;
        }
        .section-subtitle {
            font-size: 1.125rem;
            text-align: center;
            color: #94a3b8; /* Slate 400 */
            max-width: 800px;
            margin: 0 auto 3rem auto;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .btn-primary {
            background-color: var(--agt-orange);
            color: white;
        }
        .btn-primary:hover {
            background-color: #FB923C; /* Orange 400 */
        }
        .btn-secondary {
            background-color: #334155; /* Slate 700 */
            color: var(--agt-text);
        }
        .btn-secondary:hover {
             background-color: #475569; /* Slate 600 */
        }
        .btn-active {
            background-color: var(--agt-orange);
            color: white;
            box-shadow: 0 0 15px rgba(249, 115, 22, 0.5);
        }
        .card {
            background-color: #1E293B; /* Slate 800 */
            border-radius: 0.75rem;
            padding: 1.5rem;
            border: 1px solid #334155; /* Slate 700 */
            height: 100%;
        }

        /* 3D Flip Card Styles */
        .flip-card {
            background-color: transparent;
            width: 100%;
            min-height: 220px;
            perspective: 1000px;
        }
        .chart-flip-card {
            height: 450px;
        }
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }
        
        /* HOVER flip for informational cards */
        .hover-flip-card:hover .flip-card-inner {
            transform: rotateY(180deg);
        }

        /* CLICK flip for chart cards */
        .chart-flip-card.is-flipped .flip-card-inner {
            transform: rotateY(180deg);
        }

        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden; /* Safari */
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #1E293B; /* Slate 800 */
            border-radius: 0.75rem;
            border: 1px solid #334155; /* Slate 700 */
            padding: 1.5rem;
        }
        .flip-card-back {
            transform: rotateY(180deg);
        }
        .flip-trigger {
            position: absolute;
            top: 15px;
            right: 15px;
            cursor: pointer;
            z-index: 10;
            color: #94a3b8;
            transition: color 0.3s;
        }
        .flip-trigger:hover {
            color: var(--agt-orange);
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">

        <!-- HEADER -->
        <header class="mb-16 text-center">
            <img src="https://i.imgur.com/your_code_here.jpg" 
                 alt="Equipo de profesionales analizando datos en un entorno tecnológico"
                 class="w-full h-64 md:h-96 object-cover rounded-xl mb-8 opacity-75">
            <h1 class="text-4xl md:text-6xl font-extrabold mb-4 leading-tight">
                Transforme su Wi-Fi de un <span class="text-red-400">Gasto</span> a un <span class="text-green-400">Activo Estratégico</span>
            </h1>
            <p class="section-subtitle">Descubra cómo la solución OhmyFi + Zoho CRM, implementada por AGT, convierte su red de invitados en un motor de inteligencia de negocios y crecimiento para el mercado venezolano.</p>
        </header>

        <!-- DATA JOURNEY SECTION -->
        <section class="mb-20">
            <h2 class="section-title">El Viaje del Dato: De Conexión a Conversión</h2>
            <p class="section-subtitle">Visualice el flujo de valor. Así es como convertimos una simple conexión Wi-Fi en una relación rentable y medible con sus clientes.</p>
            <div class="grid grid-cols-1 md:grid-cols-5 gap-6 relative">
                
                <div class="flip-card hover-flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front card">
                             <i data-lucide="wifi" class="w-12 h-12 mb-4 text-orange-500"></i>
                             <h3 class="font-bold text-lg mb-2">1. Conexión</h3>
                             <p class="text-sm text-slate-400">El cliente se conecta al Wi-Fi gratuito a través de un portal cautivo personalizado.</p>
                        </div>
                        <div class="flip-card-back">
                             <h3 class="font-bold text-lg mb-2 text-orange-400">Portal de Marca</h3>
                             <p class="text-sm text-slate-300">El primer contacto es clave. Creamos un portal de acceso con su identidad de marca que ofrece una experiencia de conexión segura y profesional.</p>
                        </div>
                    </div>
                </div>
                <div class="flip-card hover-flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front card">
                            <i data-lucide="database" class="w-12 h-12 mb-4 text-orange-500"></i>
                            <h3 class="font-bold text-lg mb-2">2. Captura</h3>
                            <p class="text-sm text-slate-400">Se capturan datos de primera mano (First-Party Data) con consentimiento explícito.</p>
                        </div>
                        <div class="flip-card-back">
                            <h3 class="font-bold text-lg mb-2 text-orange-400">Activo de Datos</h3>
                            <p class="text-sm text-slate-300">Los "First-Party Data" son su activo más valioso: precisos, relevantes y obtenidos con consentimiento para una personalización efectiva y legal.</p>
                        </div>
                    </div>
                </div>
                <div class="flip-card hover-flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front card">
                            <i data-lucide="users" class="w-12 h-12 mb-4 text-orange-500"></i>
                            <h3 class="font-bold text-lg mb-2">3. Perfilamiento</h3>
                            <p class="text-sm text-slate-400">El perfil del cliente se crea o actualiza automáticamente en Zoho CRM.</p>
                        </div>
                         <div class="flip-card-back">
                            <h3 class="font-bold text-lg mb-2 text-orange-400">Inteligencia 360°</h3>
                            <p class="text-sm text-slate-300">La integración nativa con Zoho CRM enriquece el perfil del cliente, unificando su comportamiento online y offline para una visión completa.</p>
                        </div>
                    </div>
                </div>
                 <div class="flip-card hover-flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front card">
                            <i data-lucide="send" class="w-12 h-12 mb-4 text-orange-500"></i>
                            <h3 class="font-bold text-lg mb-2">4. Activación</h3>
                            <p class="text-sm text-slate-400">Se disparan campañas de marketing automatizadas y personalizadas.</p>
                        </div>
                        <div class="flip-card-back">
                           <h3 class="font-bold text-lg mb-2 text-orange-400">Marketing de Precisión</h3>
                           <p class="text-sm text-slate-300">La automatización permite impactar al cliente correcto en el momento oportuno con ofertas relevantes que impulsan la conversión.</p>
                        </div>
                    </div>
                </div>
                <div class="flip-card hover-flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front card">
                            <i data-lucide="bar-chart-2" class="w-12 h-12 mb-4 text-orange-500"></i>
                            <h3 class="font-bold text-lg mb-2">5. Medición</h3>
                            <p class="text-sm text-slate-400">Se mide el ROI, LTV y el impacto real de cada interacción en las ventas.</p>
                        </div>
                        <div class="flip-card-back">
                            <h3 class="font-bold text-lg mb-2 text-orange-400">Cierre del Ciclo</h3>
                            <p class="text-sm text-slate-300">La solución permite atribuir ventas a las campañas de WiFi Marketing, demostrando el valor tangible y el ROI. Dejamos de adivinar y empezamos a medir.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SIMULATOR SECTION -->
        <section id="simulator" class="mb-20">
             <div class="flex flex-col md:flex-row justify-between items-center mb-8">
                <div class="text-center md:text-left mb-6 md:mb-0">
                    <h2 class="section-title !text-left !mb-0">Simulador Financiero Interactivo</h2>
                    <p class="section-subtitle !text-left !ml-0 max-w-2xl">Ajuste las variables y proyecte el impacto financiero real. Compare dos escenarios clave para el mercado venezolano.</p>
                </div>
                <button id="generate-report-btn" class="btn btn-primary"><i data-lucide="download" class="w-5 h-5 mr-2"></i>Generar Informe PDF</button>
            </div>
            
            <div class="text-center mb-8">
                <button id="btn-completa" class="btn btn-active mr-4">Escenario 1: Solución Completa (AGT)</button>
                <button id="btn-byod" class="btn btn-secondary">Escenario 2: Infraestructura Propia (BYOD)</button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Columna de Inputs -->
                <div class="lg:col-span-1 space-y-6 flex flex-col">
                    <div id="image-container" class="mb-6">
                        <img id="scenario-image" src="https://i.imgur.com/your_code_here.jpg" 
                             alt="Técnico instalando un punto de acceso Wi-Fi"
                             class="w-full h-auto object-cover rounded-lg transition-opacity duration-500">
                    </div>
                    
                    <div class="card flex-1">
                         <h3 class="text-xl font-bold mb-4 text-orange-400 flex items-center"><i data-lucide="sliders-horizontal" class="w-6 h-6 mr-2"></i>Parámetros de Simulación</h3>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block mb-2 text-sm font-medium">APs Interiores</label>
                                <input type="number" id="aps-indoor" value="5" class="w-full p-2 rounded bg-slate-700 border border-slate-600 focus:ring-orange-500 focus:border-orange-500">
                            </div>
                            <div>
                                <label class="block mb-2 text-sm font-medium">APs Exteriores</label>
                                <input type="number" id="aps-outdoor" value="1" class="w-full p-2 rounded bg-slate-700 border border-slate-600 focus:ring-orange-500 focus:border-orange-500">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block mb-2 text-sm font-medium">Valor de Vida del Cliente (LTV - USD)</label>
                                <input type="number" id="customer-ltv" value="150" class="w-full p-2 rounded bg-slate-700 border border-slate-600 focus:ring-orange-500 focus:border-orange-500">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block mb-2 text-sm font-medium">Costo Mensual del Servicio de Internet (USD)</label>
                                <input type="number" id="internet-cost" value="100" class="w-full p-2 rounded bg-slate-700 border border-slate-600 focus:ring-orange-500 focus:border-orange-500">
                            </div>
                         </div>
                    </div>

                     <div id="financing-section" class="card flex-1">
                        <h3 class="text-xl font-bold mb-4 text-orange-400 flex items-center"><i data-lucide="banknote" class="w-6 h-6 mr-2"></i>Financiamiento (Sol. Completa)</h3>
                        <label for="financing-term" class="block mb-2 text-sm font-medium">Plazo de Financiamiento: <span id="financing-term-value" class="font-bold text-orange-400">0</span> meses</label>
                        <input type="range" id="financing-term" min="0" max="3" value="0" step="1" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                    </div>
                </div>

                <!-- Columna de Dashboard -->
                <div class="lg:col-span-2">
                    <div id="dashboard" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        
                        <div class="md:col-span-2 card text-center">
                            <h3 class="text-lg font-semibold text-slate-400">Retorno de la Inversión (ROI) a 3 Años</h3>
                            <p id="roi-value" class="text-5xl font-extrabold text-green-400 my-2">0%</p>
                            <p id="roi-text" class="text-sm text-slate-400">...</p>
                        </div>

                        <div class="card text-center">
                             <h3 class="text-lg font-semibold text-slate-400">Costo Total de Propiedad (TCO) a 3 Años</h3>
                            <p id="tco-value" class="text-4xl font-bold text-red-400 my-2">$0</p>
                            <p id="tco-text" class="text-sm text-slate-400">...</p>
                        </div>
                        
                        <div class="card text-center">
                            <h3 class="text-lg font-semibold text-slate-400">Período de Recuperación (Payback)</h3>
                            <p id="payback-value" class="text-4xl font-bold text-blue-400 my-2">0 Meses</p>
                            <p id="payback-text" class="text-sm text-slate-400">...</p>
                        </div>
                        
                        <div class="flip-card chart-flip-card">
                            <div class="flip-card-inner">
                                <div class="flip-card-front">
                                    <i data-lucide="info" class="flip-trigger"></i>
                                    <h3 class="font-bold mb-2">Componentes del ROI</h3>
                                    <canvas id="roiComponentsChart"></canvas>
                                </div>
                                <div class="flip-card-back">
                                    <h3 class="font-bold text-xl mb-4 text-orange-400">¿Qué Muestra este Gráfico?</h3>
                                    <p class="text-base text-slate-300 mb-6">Compara el **Beneficio Neto Total** contra el **Costo Total de Propiedad (TCO)**. Un beneficio mayor que el costo resulta en un ROI positivo.</p>
                                    <button class="btn btn-secondary flip-back-trigger"><i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>Volver</button>
                                </div>
                            </div>
                        </div>

                        <div class="flip-card chart-flip-card">
                            <div class="flip-card-inner">
                                <div class="flip-card-front">
                                     <i data-lucide="info" class="flip-trigger"></i>
                                    <h3 class="font-bold mb-2">Desglose del TCO</h3>
                                    <canvas id="tcoBreakdownChart"></canvas>
                                </div>
                                <div class="flip-card-back">
                                    <h3 class="font-bold text-xl mb-4 text-orange-400">Entendiendo el TCO</h3>
                                    <p class="text-base text-slate-300 mb-6">Muestra su inversión, incluyendo **hardware (CAPEX)** y **costos operativos (OPEX)**. Clave para una planificación financiera precisa.</p>
                                    <button class="btn btn-secondary flip-back-trigger"><i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>Volver</button>
                                </div>
                            </div>
                        </div>

                         <div class="flip-card chart-flip-card">
                            <div class="flip-card-inner">
                                <div class="flip-card-front">
                                     <i data-lucide="info" class="flip-trigger"></i>
                                    <h3 class="font-bold mb-2">Evolución de Costos Mensuales</h3>
                                    <canvas id="monthlyCostsChart"></canvas>
                                </div>
                                <div class="flip-card-back">
                                    <h3 class="font-bold text-xl mb-4 text-orange-400">Estructura de Costos</h3>
                                    <p class="text-base text-slate-300 mb-6">Este gráfico desglosa los costos a lo largo del tiempo. Muestra la **inversión inicial (CAPEX)** en el primer mes y los **costos operativos recurrentes (OPEX)** en los meses subsiguientes.</p>
                                    <button class="btn btn-secondary flip-back-trigger"><i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>Volver</button>
                                </div>
                            </div>
                        </div>

                        <div class="flip-card chart-flip-card">
                            <div class="flip-card-inner">
                                <div class="flip-card-front">
                                     <i data-lucide="info" class="flip-trigger"></i>
                                    <h3 class="font-bold mb-2">Camino a la Rentabilidad (Payback)</h3>
                                    <canvas id="paybackChart"></canvas>
                                </div>
                                <div class="flip-card-back">
                                    <h3 class="font-bold text-xl mb-4 text-orange-400">El Punto de Equilibrio</h3>
                                    <p class="text-base text-slate-300 mb-6">Ilustra el "Período de Recuperación". Muestra la **inversión acumulada** y cómo los **ingresos acumulados** la superan. El punto de cruce es su punto de equilibrio.</p>
                                    <button class="btn btn-secondary flip-back-trigger"><i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>Volver</button>
                                </div>
                            </div>
                        </div>

                         <div class="flip-card chart-flip-card md:col-span-2">
                            <div class="flip-card-inner">
                                <div class="flip-card-front">
                                     <i data-lucide="info" class="flip-trigger"></i>
                                    <h3 class="font-bold mb-2">Simulación Monte Carlo del ROI (Análisis de Riesgo)</h3>
                                    <canvas id="monteCarloChart"></canvas>
                                </div>
                                <div class="flip-card-back">
                                    <h3 class="font-bold text-xl mb-4 text-orange-400">Análisis de Sensibilidad</h3>
                                    <p class="text-base text-slate-300 mb-6">Esta simulación ejecuta 10,000 escenarios variando LTV y Conversión para medir la resiliencia del ROI. Un resultado concentrado en valores altos indica una inversión de bajo riesgo.</p>
                                    <button class="btn btn-secondary flip-back-trigger"><i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>Volver</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SIGNIFICADOS SECTION -->
        <section id="glossary" class="mb-16">
            <h2 class="section-title">Glosario Financiero</h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                 <div class="flip-card hover-flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front card">
                            <h3 class="font-bold text-lg text-orange-400 mb-2">Retorno de la Inversión (ROI)</h3>
                            <p class="text-sm text-slate-300">Mide la ganancia o pérdida generada en relación con el monto invertido.</p>
                        </div>
                        <div class="flip-card-back">
                           <p class="text-sm text-slate-300">Un ROI alto indica alta rentabilidad. Es el indicador final del éxito financiero de una inversión.</p>
                        </div>
                    </div>
                </div>
                 <div class="flip-card hover-flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front card">
                            <h3 class="font-bold text-lg text-orange-400 mb-2">Costo Total de Propiedad (TCO)</h3>
                            <p class="text-sm text-slate-300">Cálculo de todos los costos de la solución en su vida útil (3 años).</p>
                        </div>
                        <div class="flip-card-back">
                            <p class="text-sm text-slate-300">Incluye costos directos (hardware, licencias) e indirectos (soporte, mantenimiento), ofreciendo una visión completa de la inversión.</p>
                        </div>
                    </div>
                </div>
                <div class="flip-card hover-flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front card">
                            <h3 class="font-bold text-lg text-orange-400 mb-2">Período de Recuperación</h3>
                            <p class="text-sm text-slate-300">El tiempo necesario para que los ingresos generados igualen la inversión.</p>
                        </div>
                        <div class="flip-card-back">
                           <p class="text-sm text-slate-300">Un período de recuperación (Payback) corto es ideal, ya que indica que la inversión comienza a generar ganancias netas rápidamente.</p>
                        </div>
                    </div>
                </div>
                <div class="flip-card hover-flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front card">
                           <h3 class="font-bold text-lg text-orange-400 mb-2">Valor de Vida del Cliente (LTV)</h3>
                           <p class="text-sm text-slate-300">La ganancia neta total que se espera de un cliente durante toda su relación comercial.</p>
                        </div>
                        <div class="flip-card-back">
                           <p class="text-sm text-slate-300">Aumentar el LTV es un objetivo clave. Esta solución lo potencia a través del marketing de fidelización y la re-compra.</p>
                        </div>
                    </div>
                </div>
                 <div class="flip-card hover-flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front card">
                           <h3 class="font-bold text-lg text-orange-400 mb-2">CAPEX</h3>
                           <p class="text-sm text-slate-300">Gastos en activos fijos (Capital Expenditures), como el hardware. Es una inversión inicial.</p>
                        </div>
                         <div class="flip-card-back">
                           <p class="text-sm text-slate-300">Se realiza una sola vez y se deprecia con el tiempo. Distinto de los gastos operativos recurrentes.</p>
                        </div>
                    </div>
                </div>
                <div class="flip-card hover-flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front card">
                            <h3 class="font-bold text-lg text-orange-400 mb-2">OPEX</h3>
                            <p class="text-sm text-slate-300">Gastos operativos continuos (Operational Expenditures), como licencias y soporte.</p>
                        </div>
                        <div class="flip-card-back">
                            <p class="text-sm text-slate-300">Son los costos recurrentes para mantener la solución funcionando. Son predecibles y se presupuestan anualmente.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <footer class="text-center py-8 border-t border-slate-700">
            <p class="text-slate-400">Simulador Financiero v11.0 | Desarrollado por Gemini para AGT Comunidades</p>
        </footer>

    </div>

    <!-- PDF Report Modal -->
    <div id="report-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 transition-opacity duration-300 opacity-0 pointer-events-none">
        <div class="bg-slate-800 rounded-lg shadow-xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-orange-400">Resumen Ejecutivo de la Simulación</h2>
                <button id="report-close-btn" class="text-slate-400 hover:text-white">&times;</button>
            </div>
            <div class="bg-slate-900 p-4 rounded-md mb-6">
                <pre id="report-content" class="text-sm text-slate-300 whitespace-pre-wrap font-mono"></pre>
            </div>
            <div class="text-right">
                <button id="report-download-btn" class="btn btn-primary"><i data-lucide="download" class="w-5 h-5 mr-2"></i>Descargar PDF</button>
            </div>
        </div>
    </div>

<script>
    // V6.0 CALCULATION ENGINE
    const PRICING = {
        AP_INDOOR: { COST: 180, PRICE: 250 },
        AP_OUTDOOR: { COST: 350, PRICE: 450 },
        CONTROLLER: { COST: 150, PRICE: 250 },
        AUX_COMPONENT_PER_AP: { COST: 50, PRICE: 75 },
        CONFIG_FEE_BASE: { COST: 200, PRICE: 500 },
        CONFIG_FEE_PER_AP: { COST: 25, PRICE: 50 },
        INSTALL_FEE_PER_AP: { COST: 40, PRICE: 75 },
        LICENSE_PER_AP_YEAR: 100,
        SUPPORT_BASE_YEAR: 500,
        SUPPORT_PER_AP_YEAR: 50,
        FINANCING_INTEREST: 0.15,
        BYOD_CONFIG_FEE_BASE: { COST: 400, PRICE: 800 }
    };

    const ROI_PARAMS = {
        LEADS_PER_AP_MONTH: 30,
        CONVERSION_RATE: 0.25
    };

    const ui = {
        buttons: { completa: document.getElementById('btn-completa'), byod: document.getElementById('btn-byod') },
        inputs: { apsIndoor: document.getElementById('aps-indoor'), apsOutdoor: document.getElementById('aps-outdoor'), customerLTV: document.getElementById('customer-ltv'), internetCost: document.getElementById('internet-cost') },
        financing: { section: document.getElementById('financing-section'), slider: document.getElementById('financing-term'), valueLabel: document.getElementById('financing-term-value') },
        outputs: { roi: { value: document.getElementById('roi-value'), text: document.getElementById('roi-text') }, tco: { value: document.getElementById('tco-value'), text: document.getElementById('tco-text') }, payback: { value: document.getElementById('payback-value'), text: document.getElementById('payback-text') } },
        scenario: { image: document.getElementById('scenario-image') },
        report: { modal: document.getElementById('report-modal'), generateBtn: document.getElementById('generate-report-btn'), closeBtn: document.getElementById('report-close-btn'), downloadBtn: document.getElementById('report-download-btn'), content: document.getElementById('report-content') }
    };

    let currentScenario = 'completa';
    let charts = {};
    let lastCalculationData = {};

    function initialize() {
        setupEventListeners();
        createCharts();
        setScenario('completa');
    }

    function setupEventListeners() {
        ui.buttons.completa.addEventListener('click', () => setScenario('completa'));
        ui.buttons.byod.addEventListener('click', () => setScenario('byod'));
        Object.values(ui.inputs).forEach(input => input.addEventListener('input', calculate));
        ui.financing.slider.addEventListener('input', () => { ui.financing.valueLabel.textContent = ui.financing.slider.value; calculate(); });

        document.querySelectorAll('.chart-flip-card').forEach(card => {
            const trigger = card.querySelector('.flip-trigger');
            const backTrigger = card.querySelector('.flip-back-trigger');
            if(trigger) { trigger.addEventListener('click', (e) => { e.stopPropagation(); card.classList.add('is-flipped'); }); }
            if(backTrigger) { backTrigger.addEventListener('click', (e) => { e.stopPropagation(); card.classList.remove('is-flipped'); }); }
        });
        
        ui.report.generateBtn.addEventListener('click', () => { ui.report.content.textContent = generateReportText(lastCalculationData); ui.report.modal.classList.remove('opacity-0', 'pointer-events-none'); });
        ui.report.closeBtn.addEventListener('click', () => ui.report.modal.classList.add('opacity-0', 'pointer-events-none'));
        ui.report.downloadBtn.addEventListener('click', () => downloadPDF(lastCalculationData));
    }

    function setScenario(scenario) {
        currentScenario = scenario;
        ui.buttons.completa.classList.toggle('btn-active', scenario === 'completa');
        ui.buttons.completa.classList.toggle('btn-secondary', scenario !== 'completa');
        ui.buttons.byod.classList.toggle('btn-active', scenario === 'byod');
        ui.buttons.byod.classList.toggle('btn-secondary', scenario !== 'byod');
        ui.financing.section.style.display = scenario === 'completa' ? 'block' : 'none';
        
        ui.scenario.image.style.opacity = 0;
        setTimeout(() => {
            ui.scenario.image.src = scenario === 'completa' ? 'https://i.imgur.com/your_code_here.jpg' : 'https://i.imgur.com/your_code_here.jpg';
            ui.scenario.image.style.opacity = 1;
        }, 500);
        calculate();
    }

    function calculate() {
        const values = {
            apsIndoor: parseInt(ui.inputs.apsIndoor.value) || 0,
            apsOutdoor: parseInt(ui.inputs.apsOutdoor.value) || 0,
            customerLTV: parseFloat(ui.inputs.customerLTV.value) || 0,
            internetCost: parseFloat(ui.inputs.internetCost.value) || 0,
            financingTerm: parseInt(ui.financing.slider.value, 10) || 0,
        };

        const totalAps = values.apsIndoor + values.apsOutdoor;

        let hardwareCost, controllerCost, auxComponentsCost, configFee, installFee, capex;
        
        if (currentScenario === 'completa') {
            hardwareCost = (values.apsIndoor * PRICING.AP_INDOOR.PRICE) + (values.apsOutdoor * PRICING.AP_OUTDOOR.PRICE);
            controllerCost = PRICING.CONTROLLER.PRICE;
            auxComponentsCost = totalAps * PRICING.AUX_COMPONENT_PER_AP.PRICE;
            configFee = PRICING.CONFIG_FEE_BASE.PRICE + (totalAps * PRICING.CONFIG_FEE_PER_AP.PRICE);
            installFee = totalAps * PRICING.INSTALL_FEE_PER_AP.PRICE;
            capex = hardwareCost + controllerCost + auxComponentsCost + configFee + installFee;
        } else { // byod
            capex = PRICING.BYOD_CONFIG_FEE_BASE.PRICE + (totalAps * PRICING.CONFIG_FEE_PER_AP.PRICE);
        }

        let financingCost = 0;
        let paybackNoFinancing = -1;
        if (currentScenario === 'completa' && values.financingTerm > 0) {
            financingCost = capex * PRICING.FINANCING_INTEREST * (values.financingTerm / 12);
        }

        const annualLicense = totalAps * PRICING.LICENSE_PER_AP_YEAR;
        const annualSupport = PRICING.SUPPORT_BASE_YEAR + (totalAps * PRICING.SUPPORT_PER_AP_YEAR);
        const annualInternet = values.internetCost * 12;
        
        const totalOpex = (annualLicense + annualSupport + annualInternet) * 3;
        const tco = capex + totalOpex + financingCost;

        const newCustomersMonthly = totalAps * ROI_PARAMS.LEADS_PER_AP_MONTH * ROI_PARAMS.CONVERSION_RATE;
        const totalRevenue = newCustomersMonthly * 12 * 3 * values.customerLTV;
        const netBenefit = totalRevenue - tco;
        const roi = tco > 0 ? (netBenefit / tco) : 0;
        
        const monthlyRevenue = newCustomersMonthly * values.customerLTV;
        const monthlyOpex = (annualLicense + annualSupport + annualInternet) / 12;
        
        let cumulativeNet = -capex;
        let paybackPeriod = -1;
        const monthlyData = { costs: [], revenues: [], opex: [], capex: [] };

        for (let month = 1; month <= 36; month++) {
            cumulativeNet += monthlyRevenue - monthlyOpex;
            if (cumulativeNet > 0 && paybackPeriod === -1) {
                paybackPeriod = month;
            }
            monthlyData.revenues.push(monthlyRevenue * month);
            monthlyData.costs.push(capex + (monthlyOpex * month));
            monthlyData.opex.push(monthlyOpex);
            monthlyData.capex.push(month === 1 ? capex : 0);
        }
        
        if (financingCost > 0) {
             let cumulativeNetNoFin = -capex;
             for (let month = 1; month <= 36; month++) {
                 cumulativeNetNoFin += monthlyRevenue - monthlyOpex;
                 if (cumulativeNetNoFin > 0) {
                     paybackNoFinancing = month;
                     break;
                 }
             }
        }

        const monteCarloResults = runMonteCarlo(values, totalAps, capex, totalOpex, financingCost);
        lastCalculationData = { ...values, totalAps, capex, tco, totalRevenue, netBenefit, roi, paybackPeriod, paybackNoFinancing, totalOpex, financingCost, scenario: currentScenario, newCustomersMonthly, annualLicense, annualSupport, annualInternet, monteCarloResults, monthlyData };
        
        updateUI(lastCalculationData);
    }

    function runMonteCarlo(values, totalAps, capex, totalOpex, financingCost) {
        const simulations = 10000;
        const results = [];
        for (let i = 0; i < simulations; i++) {
            const ltvVar = values.customerLTV * (0.8 + Math.random() * 0.4); // +/- 20%
            const convRateVar = ROI_PARAMS.CONVERSION_RATE * (0.8 + Math.random() * 0.4); // +/- 20%
            const newCustMonthVar = totalAps * ROI_PARAMS.LEADS_PER_AP_MONTH * convRateVar;
            const totalRevVar = newCustMonthVar * 36 * ltvVar;
            const tcoVar = capex + totalOpex + financingCost;
            const netBenefitVar = totalRevVar - tcoVar;
            const roiVar = tcoVar > 0 ? (netBenefitVar / tcoVar) : 0;
            results.push(roiVar);
        }
        return results;
    }
    
    function updateUI(d) {
        const formatCurrency = (val) => `$${val.toLocaleString('en-US', {maximumFractionDigits:0})}`;
        ui.outputs.roi.value.textContent = `${(d.roi * 100).toFixed(0)}%`;
        ui.outputs.tco.value.textContent = formatCurrency(d.tco);
        ui.outputs.payback.value.textContent = d.paybackPeriod > 0 ? `${d.paybackPeriod} Meses` : "N/A";
        
        if(d.roi > 0){
             ui.outputs.roi.text.textContent = `Por cada dólar invertido, se genera un beneficio neto de ${formatCurrency(d.roi)}, demostrando una alta rentabilidad.`;
        } else {
             ui.outputs.roi.text.textContent = `La inversión no genera un retorno positivo en 3 años bajo los parámetros actuales.`;
        }
        
        ui.outputs.tco.text.textContent = `Costo total distribuido en 3 años.`;
        
        if(d.paybackPeriod > 0) {
            if(d.financingTerm > 0 && d.paybackNoFinancing > 0 && d.paybackPeriod > d.paybackNoFinancing){
                ui.outputs.payback.text.textContent = `El financiamiento extiende el período de recuperación a ${d.paybackPeriod} meses para proteger su flujo de caja. Sin financiamiento, la recuperación sería en ${d.paybackNoFinancing} meses.`;
            } else {
                ui.outputs.payback.text.textContent = `La inversión se recupera y empieza a generar ganancias en el mes ${d.paybackPeriod}.`;
            }
        } else {
            ui.outputs.payback.text.textContent = 'Los ingresos no cubren la inversión en 3 años.';
        }
        
        updateCharts(d);
    }

    function createCharts() {
        const chartOptions = { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: 'white' } } }, scales: { x: { ticks: { color: 'white' }, grid: { color: '#334155' } }, y: { ticks: { color: 'white' }, grid: { color: '#334155' } } } };
        charts.roiComponents = new Chart(document.getElementById('roiComponentsChart').getContext('2d'), { type: 'bar', data: { labels: ['Análisis de Rentabilidad'], datasets: [{ label: 'Beneficio Neto', data: [], backgroundColor: '#22C55E' }, { label: 'Costo Total (TCO)', data: [], backgroundColor: '#EF4444' }] }, options: chartOptions });
        charts.tcoBreakdown = new Chart(document.getElementById('tcoBreakdownChart').getContext('2d'), { type: 'doughnut', data: { labels: ['Inversión Inicial (CAPEX)', 'Costos Operativos (OPEX)'], datasets: [{ data: [], backgroundColor: ['#3B82F6', '#F97316'] }] }, options: { ...chartOptions, scales: {} } });
        charts.payback = new Chart(document.getElementById('paybackChart').getContext('2d'), { type: 'line', data: { labels: Array.from({ length: 36 }, (_, i) => i + 1), datasets: [{ label: 'Ingresos Acumulados', data: [], borderColor: '#22C55E', tension: 0.1, fill: false }, { label: 'Costos Acumulados', data: [], borderColor: '#EF4444', tension: 0.1, fill: false }] }, options: { ...chartOptions, scales: { ...chartOptions.scales, x: { ...chartOptions.scales.x, title: { display: true, text: 'Meses', color:'white' } } } } });
        charts.monthlyCosts = new Chart(document.getElementById('monthlyCostsChart').getContext('2d'), { type: 'bar', data: { labels: Array.from({ length: 12 }, (_, i) => `Mes ${i+1}`), datasets: [{ label: 'OPEX Mensual', data: [], backgroundColor: '#F97316' }, { label: 'CAPEX (Mes 1)', data: [], backgroundColor: '#3B82F6' }] }, options: { ...chartOptions, scales: { ...chartOptions.scales, x: { stacked: true }, y: { stacked: true } } } });
        charts.monteCarlo = new Chart(document.getElementById('monteCarloChart').getContext('2d'), { type: 'bar', data: { labels: [], datasets: [{ label: 'Frecuencia', data: [], backgroundColor: '#8B5CF6' }] }, options: { ...chartOptions, scales: { ...chartOptions.scales, x: { ...chartOptions.scales.x, title: { display: true, text: 'Rango de ROI (%)', color:'white' } }, y: { ...chartOptions.scales.y, title: { display: true, text: 'Nº de Simulaciones', color:'white' } } } } });
    }

    function updateCharts(d) {
        charts.roiComponents.data.datasets[0].data = [d.netBenefit > 0 ? d.netBenefit : 0];
        charts.roiComponents.data.datasets[1].data = [d.tco];
        charts.roiComponents.update();
        charts.tcoBreakdown.data.datasets[0].data = [d.capex, d.totalOpex];
        charts.tcoBreakdown.update();
        charts.payback.data.datasets[0].data = d.monthlyData.revenues;
        charts.payback.data.datasets[1].data = d.monthlyData.costs;
        charts.payback.update();
        charts.monthlyCosts.data.datasets[0].data = d.monthlyData.opex.slice(0, 12);
        charts.monthlyCosts.data.datasets[1].data = d.monthlyData.capex.slice(0, 12);
        charts.monthlyCosts.update();

        const bins = {};
        const binSize = 0.5; // 50%
        d.monteCarloResults.forEach(roi => {
            const bin = Math.floor(roi / binSize) * binSize;
            bins[bin] = (bins[bin] || 0) + 1;
        });
        const sortedBins = Object.keys(bins).map(parseFloat).sort((a, b) => a - b);
        charts.monteCarlo.data.labels = sortedBins.map(bin => `${(bin*100).toFixed(0)}% a ${((bin + binSize)*100).toFixed(0)}%`);
        charts.monteCarlo.data.datasets[0].data = sortedBins.map(bin => bins[bin]);
        charts.monteCarlo.update();
    }
    
    function generateReportText(d) {
        const scenarioText = d.scenario === 'completa' ? 'Solución Completa (AGT)' : 'Infraestructura Propia (BYOD)';
        return `
INFORME DE ANÁLISIS FINANCIERO - SOLUCIÓN AGT OHMYFI
=====================================================
Fecha: ${new Date().toLocaleDateString('es-VE')}
Escenario Simulado: ${scenarioText}

PARÁMETROS DE ENTRADA:
----------------------
- APs Interiores: ${d.apsIndoor}, APs Exteriores: ${d.apsOutdoor}, Total APs: ${d.totalAps}
- Valor de Vida del Cliente (LTV): $${d.customerLTV.toLocaleString()}
- Costo Mensual de Internet: $${d.internetCost.toLocaleString()}
${d.scenario === 'completa' ? `- Plazo de Financiamiento: ${d.financingTerm} meses` : ''}

RESULTADOS PROYECTADOS A 3 AÑOS:
--------------------------------
- INVERSIÓN INICIAL (CAPEX): $${d.capex.toLocaleString()}
- COSTOS OPERATIVOS TOTALES (OPEX): $${d.totalOpex.toLocaleString()}
${d.financingCost > 0 ? `- COSTO DE FINANCIAMIENTO: $${d.financingCost.toLocaleString(undefined, {maximumFractionDigits:0})}` : ''}

- COSTO TOTAL DE PROPIEDAD (TCO): $${d.tco.toLocaleString(undefined, {maximumFractionDigits:0})}
- INGRESOS TOTALES GENERADOS: $${d.totalRevenue.toLocaleString()}
- BENEFICIO NETO: $${d.netBenefit.toLocaleString(undefined, {maximumFractionDigits:0})}

INDICADORES CLAVE DE RENDIMIENTO (KPI):
---------------------------------------
- RETORNO DE LA INVERSIÓN (ROI): ${(d.roi * 100).toFixed(0)}%
- PERÍODO DE RECUPERACIÓN (PAYBACK): ${d.paybackPeriod > 0 ? `${d.paybackPeriod} meses` : 'No se recupera en 36 meses'}

ANÁLISIS DE RIESGO (SIMULACIÓN MONTE CARLO):
--------------------------------------------
La simulación de 10,000 escenarios muestra que la inversión es robusta.
El ROI más probable se concentra en los rangos más altos, indicando
un bajo riesgo y una alta probabilidad de alcanzar o superar las
proyecciones financieras.

CONCLUSIÓN:
-----------
Bajo los parámetros especificados, la implementación representa una inversión ${d.roi > 0 ? 'altamente rentable y de bajo riesgo' : 'que requiere revisión'}. El capital invertido se recuperaría en ${d.paybackPeriod > 0 ? `${d.paybackPeriod} meses` : 'más de 3 años'}, generando un retorno del ${(d.roi * 100).toFixed(0)}% sobre el costo total.
`;
    }

    function downloadPDF(d) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const reportText = generateReportText(d);
        doc.setFont('courier', 'normal');
        doc.setFontSize(10);
        doc.text(reportText, 10, 10);
        doc.save(`Reporte_OhmyFi_${d.scenario}_${new Date().toISOString().slice(0,10)}.pdf`);
    }

    window.onload = initialize;
</script>
</body>
</html>
